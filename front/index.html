<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="api-config.js"></script>
    <style>
        :root {
            --neon1: #7c4dff;
            --neon2: #00e5ff;
            --neon3: #ff54bf;
            --success: #00ff88;
            --danger: #ff4757;
            --bg1: #070518;
            --glass: rgba(255,255,255,0.04);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: var(--bg1);
            color: #eaf8ff;
        }

        /* Background effects */
        .bg-flow {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
            opacity: 0.9;
        }

        .flow-path {
            stroke-linecap: round;
            stroke-width: 0.8;
            opacity: 0.12;
            animation: flowMove 20s linear infinite;
            filter: drop-shadow(0 0 3px var(--neon1));
        }

        @keyframes flowMove {
            from { transform: translateX(0); opacity: 0.3; }
            to { transform: translateX(-900px); opacity: 0.1; }
        }

        .particle {
            position: absolute;
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--neon3), var(--neon2));
            filter: blur(6px);
            opacity: 0.08;
            animation: fFloat 6s ease-in-out infinite;
        }

        @keyframes fFloat {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            33% { transform: translateY(-15px) translateX(8px) rotate(120deg); }
            66% { transform: translateY(5px) translateX(12px) rotate(240deg); }
            100% { transform: translateY(0) translateX(0) rotate(360deg); }
        }

        /* UI Components */
        .btn-neon {
            background: linear-gradient(90deg, var(--neon3), var(--neon1));
            color: #031024;
            font-weight: 700;
            padding: .7rem 1.1rem;
            border-radius: .7rem;
            box-shadow: 0 10px 40px rgba(124,77,255,0.14);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
            display: inline-block;
        }

        .btn-neon:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(124,77,255,0.25);
        }

        .btn-neon:active {
            transform: translateY(0);
            box-shadow: 0 5px 20px rgba(124,77,255,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.05);
            color: #eaf8ff;
            font-weight: 600;
            padding: .7rem 1.1rem;
            border-radius: .7rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-block;
        }

        .btn-success {
            background: var(--success);
            color: #031024;
            font-weight: 600;
            padding: .7rem 1.1rem;
            border-radius: .7rem;
            border: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-block;
        }

        .btn-warning {
            background: #ffa502;
            color: #031024;
            font-weight: 600;
            padding: .7rem 1.1rem;
            border-radius: .7rem;
            border: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-block;
        }

        .card-3d {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 1rem;
            padding: 1.25rem;
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }

        .card-3d:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            border-color: rgba(124,77,255,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal[style*="display: block"] {
            animation: modalFadeIn 0.4s ease;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg1);
            border-radius: 1rem;
            border: 1px solid rgba(255,255,255,0.1);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal[style*="display: block"] .modal-content {
            animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--neon1);
            transform: rotate(90deg) scale(1.1);
        }

        .glow-h1 {
            font-size: clamp(30px, 6vw, 64px);
            color: white;
            font-weight: 800;
        }

        /* Auth specific */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-card {
            width: 100%;
            max-width: 400px;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.7rem;
            color: white;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--neon1);
            box-shadow: 0 0 0 2px rgba(124,77,255,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .nav-tab {
            padding: 0.7rem 1.5rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.7rem;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: rgba(124,77,255,0.2);
            border-color: var(--neon1);
            color: var(--neon1);
        }

        /* Rooms specific styles */
        .rooms-section {
            margin: 2rem 0;
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .room-card {
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.02);
            position: relative;
            transition: all 0.3s ease;
        }

        .room-card:hover {
            border-color: rgba(124,77,255,0.3);
            box-shadow: 0 15px 35px rgba(124,77,255,0.1);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .room-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
        }

        .room-layout {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-height: 200px;
            position: relative;
        }

        .sides-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            align-items: start;
        }

        .side-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100px;
            border: 1px dashed rgba(255,255,255,0.1);
            border-radius: 0.5rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .side-section:hover {
            border-color: rgba(124,77,255,0.3);
            background: rgba(124,77,255,0.05);
        }

        .side-section.drag-over {
            border-color: var(--neon1);
            background: rgba(124, 77, 255, 0.1);
            animation: pulseGlow 1s infinite;
        }

        .side-section.full-width {
            grid-column: 1 / -1;
        }

        .side-title {
            font-size: 0.875rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .beds-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            min-height: 60px;
            width: 100%;
        }

        .side-section:not(.full-width) .beds-container {
            flex-direction: column;
            align-items: center;
        }

        .side-section.full-width .beds-container {
            flex-direction: row;
            justify-content: center;
        }

        .bed {
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.75rem;
            background: rgba(255,255,255,0.03);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }

        .bed:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0,0,0,0.3);
            border-color: rgba(124,77,255,0.5);
        }

        .bed:active {
            transform: translateY(-1px) scale(1.01);
        }

        .bed.dragging {
            opacity: 0.7;
            transform: scale(0.98) rotate(2deg);
            animation: dragPulse 1s infinite;
        }

        .bed.double {
            width: 100px;
        }

        .bed.single {
            width: 80px;
            height: 50px;
        }

        .bed.editable {
            cursor: move;
        }

        .bed.editable:hover {
            border-color: var(--neon1);
            box-shadow: 0 0 10px rgba(124, 77, 255, 0.3);
        }

        .bunk {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .bed-part {
            position: relative;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }

        .bed-part:hover {
            filter: brightness(1.1);
            transform: scale(1.03);
        }

        .bed-part:active {
            transform: scale(0.98);
        }

        .bed-part.double {
            height: 40px;
        }

        .bed-part.single {
            height: 50px;
            flex: 1;
        }

        .bed-part + .bed-part {
            border-top: 1px dashed rgba(255,255,255,0.1);
        }

        .bed-part[data-state="0"] {
            background: var(--success);
            color: white;
        }

        .bed-part[data-state="1"] {
            background: var(--danger);
            color: white;
        }

        .resident-info {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .editor-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .legend {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            margin: 1rem 0;
            font-size: 0.875rem;
            color: rgba(255,255,255,0.7);
        }

        .dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 3px;
            vertical-align: middle;
            margin-right: 6px;
        }

        .dot.free { background: var(--success); }
        .dot.occupied { background: var(--danger); }
        .dot.pending { background: #ffa502; }
        .dot.expired { background: #ff4757; }

        .stats {
            font-size: 0.875rem;
            color: rgba(255,255,255,0.7);
            margin: 1rem 0;
        }

        .icon-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.7rem;
            padding: 0.7rem;
            color: #eaf8ff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-2px) scale(1.05);
        }

        .icon-btn:active {
            transform: translateY(0) scale(1);
        }

        .icon-btn.danger:hover {
            background: rgba(255,71,87,0.2);
            border-color: rgba(255,71,87,0.4);
        }

        .icon-btn.active {
            background: rgba(124, 77, 255, 0.2);
            border-color: var(--neon1);
            color: var(--neon1);
            animation: activePulse 2s infinite;
        }

        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            background: var(--danger);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255,71,87,0.6);
            animation: shake 0.5s ease;
        }

        .editing .delete-btn {
            display: flex;
        }

        .add-bed-btn {
            background: rgba(255,255,255,0.05);
            border: 1px dashed rgba(255,255,255,0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-bed-btn:hover {
            border-color: var(--neon1);
            color: var(--neon1);
            background: rgba(124, 77, 255, 0.1);
            transform: translateY(-2px);
            animation: addButtonPulse 2s infinite;
        }

        .editing .add-bed-btn {
            display: flex;
        }

        /* Bed numbering styles */
        .bed-number {
            position: absolute;
            top: 2px;
            left: 2px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            z-index: 5;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .bed-number:hover {
            background: rgba(124, 77, 255, 0.9);
            transform: scale(1.1);
        }

        .bed-number.editable {
            cursor: text;
            background: rgba(124, 77, 255, 0.8);
            padding: 1px 2px 1px 4px;
        }

        .bed-number.empty {
            background: rgba(100, 100, 100, 0.5);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            padding: 1px 4px;
        }

        .bed-number.empty:hover {
            background: rgba(124, 77, 255, 0.5);
            border-color: var(--neon1);
        }

        .bed-number-remove {
            background: rgba(255, 50, 50, 0.8);
            color: white;
            border: none;
            border-radius: 2px;
            width: 12px;
            height: 12px;
            font-size: 10px;
            line-height: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: all 0.2s ease;
        }

        .bed-number-remove:hover {
            background: rgba(255, 30, 30, 1);
            transform: scale(1.2);
        }

        .bed-number-input {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--neon1);
            color: white;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            width: 50px;
            text-align: center;
        }

        .residents-section {
            margin: 3rem 0;
        }

        .residents-list {
            margin-top: 1rem;
            margin-left: -0.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            overflow: hidden;
            background: rgba(255,255,255,0.02);
            transition: all 0.3s ease;
        }

        .residents-list:hover {
            border-color: rgba(124,77,255,0.3);
            box-shadow: 0 5px 15px rgba(124,77,255,0.1);
        }

        .resident-header {
            display: grid;
            grid-template-columns: 35px minmax(110px, 1fr) 70px 75px 75px 40px 90px 90px 80px 80px 90px;
            gap: 0.7rem;
            padding: 0.75rem 0.25rem;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-weight: 600;
            font-size: 0.8rem;
        }

        .resident-row {
            display: grid;
            grid-template-columns: 35px minmax(110px, 1fr) 70px 75px 75px 40px 90px 90px 80px 80px 90px;
            gap: 0.7rem;
            padding: 0.75rem 0.25rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            align-items: center;
        }

        .resident-row:hover {
            background: rgba(255,255,255,0.02);
        }

        .resident-header > div,
        .resident-row > div {
            overflow: visible;
            text-overflow: clip;
            white-space: nowrap;
            min-width: 0;
            line-height: 1.3;
        }
        
        .resident-header > div {
            font-size: 0.75rem;
            line-height: 1.2;
        }
        
        /* Колонка "Номер кровати" - компактное отображение */
        .resident-header > div:nth-child(6) {
            font-size: 0.65rem;
            padding: 0;
            text-align: center;
            line-height: 1.0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .resident-row > div:nth-child(2) {
            white-space: normal;
            word-break: break-word;
        }
        
        .resident-row > div:nth-child(3),
        .resident-row > div:nth-child(4),
        .resident-row > div:nth-child(5) {
            font-size: 0.75rem;
        }
        
        /* Номер кровати в строках */
        .resident-row > div:nth-child(6) {
            text-align: center;
            font-size: 0.75rem;
        }
        
        .bed-number-display {
            font-weight: 700 !important;
            color: #FFFFFF !important;
            text-align: center !important;
        }
        
        .bed-number-empty {
            color: rgba(255,255,255,0.3) !important;
            text-align: center !important;
        }

        .resident-input {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 0.25rem;
            padding: 0.25rem 0.35rem;
            color: #FFFFFF;
            font-size: 0.75rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.2s ease;
        }

        .resident-input:focus {
            outline: none;
            border-color: var(--neon1);
            background: rgba(124, 77, 255, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 77, 255, 0.2);
            color: #FFFFFF;
        }
        
        .resident-input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .payment-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.02);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .payment-stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 0.75rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .payment-stat-item:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: rgba(124,77,255,0.3);
        }

        .payment-stat-label {
            font-size: 0.875rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .payment-stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: #FFFFFF;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        .payment-stat-total {
            background: linear-gradient(135deg, var(--neon1), var(--neon2));
            animation: totalPulse 3s infinite;
        }
        
        .payment-stat-total .payment-stat-label {
            color: #031024;
            font-weight: 600;
        }
        
        .payment-stat-total .payment-stat-value {
            color: #031024;
            font-size: 2rem;
            text-shadow: 0 2px 4px rgba(255,255,255,0.3);
        }

        .custom-select {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 0.25rem;
            padding: 0.25rem 0.35rem;
            color: #FFFFFF;
            font-size: 0.75rem;
            font-weight: 600;
            width: 100%;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23eaf8ff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.25rem center;
            background-size: 0.6rem;
            transition: all 0.2s ease;
        }

        .custom-select:focus {
            outline: none;
            border-color: var(--neon1);
            background: rgba(124, 77, 255, 0.1);
            box-shadow: 0 0 15px rgba(124,77,255,0.4);
        }

        .custom-select option {
            background: var(--bg1);
            color: white;
        }

        /* Contact Section */
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .contact-card {
            text-align: center;
            padding: 2rem;
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .contact-icon svg {
            width: 30px;
            height: 30px;
        }

        .contact-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
        }

        .contact-description {
            color: rgba(255,255,255,0.7);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .copy-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .copy-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* Staff Section */
        .staff-section {
            margin-top: 2rem;
        }

        .staff-card {
            text-align: center;
            padding: 3rem 2rem;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            background: rgba(255,255,255,0.02);
        }

        .staff-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .staff-icon svg {
            width: 40px;
            height: 40px;
        }

        .staff-message {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
        }

        .staff-subtitle {
            color: rgba(255,255,255,0.7);
            line-height: 1.5;
        }

        /* User Management */
        .user-card {
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.02);
            margin-bottom: 1rem;
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.25rem;
        }

        .user-email {
            color: rgba(255,255,255,0.7);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .user-date {
            color: rgba(255,255,255,0.5);
            font-size: 0.75rem;
        }

        .user-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .access-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .access-date {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: white;
            font-size: 0.875rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .status-pending {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
            border: 1px solid rgba(255, 165, 2, 0.3);
        }

        .status-active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-expired {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .status-suspended {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
            border: 1px solid rgba(255, 165, 2, 0.3);
        }

        /* Добавим стили для заблокированных пользователей */
        .suspended-users-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: rgba(255,255,255,0.5);
        }
        
        .empty-state svg {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }

        /* Print styles */
        @media print {
            @page {
                margin: 0.5cm;
                size: landscape;
            }
            
            body * {
                visibility: hidden;
            }
            
            .residents-section, .residents-section * {
                visibility: visible;
            }
            
            .residents-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                color: black;
                margin: 0;
                padding: 0;
            }
            
            .editor-controls, .nav, .bg-flow, .rooms-section,
            .icon-btn, .bed-number {
                display: none !important;
            }
            
            /* Не скрываем инпуты и селекты, а делаем их прозрачными */
            .resident-input, .custom-select {
                border: none !important;
                background: transparent !important;
            }
            
            .residents-list {
                border: none;
                border-radius: 0;
                box-shadow: none;
                margin: 0;
                padding: 0;
                overflow: visible;
                background: white;
            }
            
            .resident-header, .resident-row {
                font-size: 10px;
                page-break-inside: avoid;
                display: table-row !important;
            }
            
            .residents-list {
                display: table !important;
                width: 100% !important;
                border-collapse: collapse !important;
            }
            
            .resident-header {
                background: #4472C4 !important;
                color: white !important;
                font-weight: bold !important;
            }
            
            .resident-header > div {
                display: table-cell !important;
                border: 1px solid #2F5597 !important;
                padding: 6px 4px !important;
                text-align: center !important;
                background: #4472C4 !important;
                color: white !important;
                font-weight: bold !important;
                vertical-align: middle !important;
                font-size: 9px !important;
                overflow: visible !important;
                white-space: nowrap !important;
            }
            
            .resident-row {
                border: none !important;
                padding: 0 !important;
            }
            
            .resident-row > div {
                display: table-cell !important;
                border: 1px solid #D0D0D0 !important;
                padding: 5px 3px !important;
                color: black !important;
                background: white !important;
                vertical-align: middle !important;
                font-size: 9px !important;
                overflow: visible !important;
                white-space: nowrap !important;
            }
            
            .resident-row > div:nth-child(2) {
                white-space: normal !important;
                word-wrap: break-word !important;
                max-width: 100px !important;
            }
            
            .resident-row > div:nth-child(6) {
                font-weight: bold !important;
            }
            
            .resident-row:nth-child(even) > div {
                background: #F2F2F2 !important;
            }
            
            .resident-row > div:first-child,
            .resident-row > div:nth-child(6) {
                text-align: center !important;
            }
            
            #residentsRows {
                display: table-row-group !important;
            }
            
            /* Показываем значения инпутов и селектов */
            .resident-row input[type="date"],
            .resident-row input[type="text"] {
                border: none !important;
                background: transparent !important;
                color: black !important;
                padding: 0 !important;
                font-size: 9px !important;
            }
            
            .resident-row select {
                border: none !important;
                background: transparent !important;
                color: black !important;
                padding: 0 !important;
                font-size: 9px !important;
                appearance: none !important;
            }
            
            /* Заголовок таблицы */
            .residents-section h2 {
                color: black !important;
                font-size: 16px !important;
                font-weight: bold !important;
                margin-bottom: 10px !important;
                padding: 10px !important;
                background: white !important;
                border-bottom: 3px solid #4472C4 !important;
            }
            
            .payment-stats {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 0 !important;
                width: 100%;
                margin-top: 20px;
                border: 2px solid #4472C4 !important;
            }
            
            .payment-stats::before {
                content: "Финансовая статистика";
                display: block;
                font-weight: bold;
                margin-bottom: 10px;
                font-size: 14px;
                color: black;
                background: #E7E6E6;
                padding: 8px;
                border-bottom: 2px solid #4472C4;
                grid-column: 1 / -1;
            }
            
            .payment-stat-item {
                text-align: center;
                padding: 10px 8px;
                border: 1px solid #D0D0D0;
                background: white;
                color: black;
            }
            
            .payment-stat-label {
                font-size: 10px !important;
                color: #666 !important;
                margin-bottom: 4px !important;
            }
            
            .payment-stat-value {
                font-size: 12px !important;
                font-weight: bold !important;
                color: black !important;
            }
            
            .payment-stat-total {
                background: #4472C4 !important;
            }
            
            .payment-stat-total .payment-stat-label,
            .payment-stat-total .payment-stat-value {
                color: white !important;
            }
        }

        /* Security elements */
        .security-check {
            display: none;
        }

        /* Navigation fixes */
        .nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
            backdrop-filter: blur(12px);
            background: linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.15));
            border-radius: 14px;
            padding: .4rem .8rem;
            border: 1px solid rgba(255,255,255,0.06);
            display: flex;
            gap: .7rem;
            align-items: center;
            max-width: 90vw;
            flex-wrap: wrap;
        }

        .logo-badge {
            display: flex;
            gap: .5rem;
            align-items: center;
            min-width: 0;
        }

        .logo-text {
            min-width: 0;
        }

        .app-name {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }

        .user-role {
            font-size: 11px;
            opacity: .7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }

        /* Avatar from second file */
        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c77dff, #00e5ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,.35);
            cursor: pointer;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .language-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }

        .language-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--bg1);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.7rem;
            padding: 0.5rem;
            min-width: 120px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(12px);
            z-index: 1000;
        }

        .language-option {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .language-option:hover {
            background: rgba(255,255,255,0.05);
        }

        .language-option.active {
            background: rgba(124, 77, 255, 0.2);
            color: var(--neon1);
        }

        /* Admin Panel Dropdown */
        .admin-dropdown {
            position: absolute;
            top: 50px;
            left: 0;
            background: var(--bg1);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.7rem;
            padding: 1rem;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(12px);
            z-index: 1000;
        }

        .admin-dropdown button {
            width: 100%;
            margin-bottom: 0.5rem;
            text-align: left;
        }

        .admin-dropdown button:last-child {
            margin-bottom: 0;
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .auth-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            color: var(--neon1);
            border-bottom-color: var(--neon1);
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .rooms-grid { 
                grid-template-columns: 1fr; 
                gap: 1rem;
            }
            .sides-row { 
                grid-template-columns: 1fr; 
                gap: 1rem;
            }
            .resident-header, .resident-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                padding: 0.75rem;
            }
            .resident-header > div, .resident-row > div {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid rgba(255,255,255,0.05);
            }
            .resident-header > div:before, .resident-row > div:before {
                content: attr(data-label);
                font-weight: 600;
                color: rgba(255,255,255,0.7);
            }
            .payment-stats {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                padding: 1rem;
            }
            .side-section .beds-container {
                flex-direction: column;
            }
            .contact-grid {
                grid-template-columns: 1fr;
            }
            .user-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .user-actions {
                width: 100%;
                justify-content: space-between;
            }
            .nav {
                top: 10px;
                padding: 0.3rem 0.6rem;
                gap: 0.5rem;
            }
            .nav-tab {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            .avatar {
                top: 10px;
                left: 10px;
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
            }
            .language-selector {
                top: 10px;
                right: 10px;
            }
            .language-btn {
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
            }
            .admin-dropdown {
                top: 46px;
                left: 0;
                min-width: 180px;
            }
            .modal-content {
                width: 95%;
                max-width: 95%;
            }
            .editor-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            .editor-controls .btn-neon, 
            .editor-controls .icon-btn {
                width: 100%;
                justify-content: center;
            }
            .legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .stats {
                text-align: center;
            }
            .room-card {
                padding: 1rem;
            }
            .bed.double {
                width: 90px;
            }
            .bed.single {
                width: 70px;
            }
            .bed-part {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
            .resident-input {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            .custom-select {
                padding: 0.6rem;
                font-size: 0.8rem;
            }
            .btn-neon, .btn-secondary, .btn-success, .btn-warning {
                padding: 0.6rem 1rem;
                font-size: 0.875rem;
            }
            .form-input {
                padding: 0.8rem;
            }
            .auth-container {
                padding: 1rem;
            }
            .auth-card {
                max-width: 100%;
            }
            .auth-tabs {
                gap: 0.25rem;
            }
            .auth-tab {
                padding: 0.6rem 1rem;
                font-size: 0.875rem;
            }
            .staff-card {
                padding: 2rem 1rem;
            }
            .staff-message {
                font-size: 1.25rem;
            }
            .contact-card {
                padding: 1.5rem;
            }
            .contact-icon {
                width: 50px;
                height: 50px;
                margin-bottom: 1rem;
            }
            .contact-icon svg {
                width: 25px;
                height: 25px;
            }
            .contact-title {
                font-size: 1.125rem;
            }
            .contact-description {
                font-size: 0.875rem;
            }
            .card-3d {
                padding: 1rem;
            }
            .payment-stat-item {
                padding: 0.75rem;
            }
            .payment-stat-label {
                font-size: 0.8rem;
            }
            .payment-stat-value {
                font-size: 1.125rem;
            }
        }

        @media (max-width: 480px) {
            .nav {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding: 0.3rem;
                gap: 0.3rem;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .nav::-webkit-scrollbar {
                display: none;
            }
            .nav-tab {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                white-space: nowrap;
            }
            .logo-badge {
                display: none;
            }
            .payment-stats {
                grid-template-columns: 1fr;
            }
            .rooms-grid {
                grid-template-columns: 1fr;
            }
            .room-layout {
                min-height: 150px;
            }
            .beds-container {
                gap: 0.5rem;
            }
            .bed.double {
                width: 80px;
            }
            .bed.single {
                width: 60px;
            }
            .bed-part {
                font-size: 0.7rem;
                padding: 0.4rem;
            }
            .resident-info {
                font-size: 0.65rem;
            }
        }

        /* Animation Keyframes */
        @keyframes pulseGlow {
            0% { 
                box-shadow: 0 0 5px rgba(124,77,255,0.3);
                border-color: var(--neon1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(124,77,255,0.8);
                border-color: var(--neon2);
            }
            100% { 
                box-shadow: 0 0 5px rgba(124,77,255,0.3);
                border-color: var(--neon1);
            }
        }

        @keyframes dragPulse {
            0% { 
                transform: scale(0.98) rotate(2deg);
                box-shadow: 0 0 10px rgba(124,77,255,0.4);
            }
            50% { 
                transform: scale(1) rotate(-1deg);
                box-shadow: 0 0 20px rgba(124,77,255,0.6);
            }
            100% { 
                transform: scale(0.98) rotate(2deg);
                box-shadow: 0 0 10px rgba(124,77,255,0.4);
            }
        }

        @keyframes activePulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(124,77,255,0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 15px rgba(124,77,255,0);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(124,77,255,0);
                transform: scale(1);
            }
        }

        @keyframes addButtonPulse {
            0% { 
                border-color: var(--neon1);
                transform: translateY(-2px);
            }
            50% { 
                border-color: var(--neon2);
                transform: translateY(-2px) scale(1.02);
            }
            100% { 
                border-color: var(--neon1);
                transform: translateY(-2px);
            }
        }

        @keyframes totalPulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 10px 30px rgba(124,77,255,0.2);
            }
            50% { 
                transform: scale(1.03);
                box-shadow: 0 15px 40px rgba(124,77,255,0.4);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 10px 30px rgba(124,77,255,0.2);
            }
        }

        @keyframes modalFadeIn {
            from { 
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            to { 
                opacity: 1;
                backdrop-filter: blur(15px);
            }
        }

        @keyframes modalSlideIn {
            from { 
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            to { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes clickRipple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1.2); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px) scale(1.2); }
            20%, 40%, 60%, 80% { transform: translateX(2px) scale(1.2); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(124,77,255,0.5); }
            50% { box-shadow: 0 0 20px rgba(124,77,255,0.8); }
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes successFlash {
            0% { background: var(--success); }
            50% { background: #00cc6a; transform: scale(1.05); }
            100% { background: var(--success); transform: scale(1); }
        }

        /* Ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.6);
            transform: scale(0);
            animation: clickRipple 0.6s linear;
            pointer-events: none;
        }

        /* Success animation */
        .success-flash {
            animation: successFlash 0.6s ease;
        }

        /* Floating animation */
        .float {
            animation: float 3s ease-in-out infinite;
        }

        /* Glow animation */
        .glow {
            animation: glow 2s ease-in-out infinite;
        }

        /* Slide in animation */
        .slide-in {
            animation: slideInFromBottom 0.6s ease;
        }

        /* Text selection animation */
        ::selection {
            background: rgba(124,77,255,0.3);
            color: white;
        }

        /* Scroll animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Improved hover effects */
        .hover-lift:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
        }

        .hover-glow:hover {
            box-shadow: 0 0 20px rgba(124,77,255,0.5);
            transition: box-shadow 0.3s ease;
        }

        @media (max-width: 1200px) {
            .residents-container {
                overflow-x: auto;
            }
            
            .residents-table {
                min-width: 1000px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-flow" aria-hidden="true">
        <svg width="1800" height="900" viewBox="0 0 1800 900" preserveAspectRatio="none" style="width:180%;height:110%;transform:translate(-10%, -5%);">
            <defs>
                <linearGradient id="gA" x1="0" x2="1">
                    <stop offset="0" stop-color="#7c4dff"/>
                    <stop offset="1" stop-color="#00e5ff"/>
                </linearGradient>
            </defs>
            <g fill="none" stroke="url(#gA)">
                <path class="flow-path" d="M0 120 C 350 10, 700 200, 1200 120" stroke-width="1.4"/>
                <path class="flow-path" d="M0 260 C 250 180, 500 20, 1100 260" stroke-width="1.1"/>
                <path class="flow-path" d="M0 420 C 400 320, 800 560, 1400 420" stroke-width="1.6"/>
            </g>
        </svg>

        <!-- Particles -->
        <div class="particle" style="left:8%; top:12%;"></div>
        <div class="particle" style="left:22%; top:8%;"></div>
        <div class="particle" style="left:40%; top:34%;"></div>
        <div class="particle" style="left:62%; top:10%;"></div>
        <div class="particle" style="left:80%; top:42%;"></div>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <div class="language-btn" id="languageBtn" onclick="toggleLanguageDropdown()">
            <span id="currentLang">RU</span>
        </div>
        <div id="languageDropdown" class="language-dropdown" style="display: none;">
            <div class="language-option active" data-lang="ru" onclick="changeLanguage('ru')">
                <span>🇷🇺</span> Русский
            </div>
            <div class="language-option" data-lang="uz" onclick="changeLanguage('uz')">
                <span>🇺🇿</span> O'zbek
            </div>
            <div class="language-option" data-lang="en" onclick="changeLanguage('en')">
                <span>🇺🇸</span> English
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-container">
        <div class="card-3d auth-card">
            <div class="text-center mb-8">
                <h1 class="glow-h1 mb-2" data-i18n="app_title">Hostel Manager</h1>
                <p class="text-white/70" data-i18n="app_subtitle">Система управления хостелом</p>
            </div>

            <!-- Auth Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthTab('login')" data-i18n="login_tab">Вход</button>
                <button class="auth-tab" onclick="showAuthTab('register')" data-i18n="register_tab">Регистрация</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2 class="text-xl font-bold mb-6 text-center" data-i18n="login_title">Вход в систему</h2>
                <input type="text" id="loginUsername" class="form-input" data-i18n-placeholder="login_username" placeholder="Логин">
                <input type="password" id="loginPassword" class="form-input" data-i18n-placeholder="login_password" placeholder="Пароль">
                <button class="btn-neon w-full mb-4" onclick="login()" data-i18n="login_button">Войти</button>
                <div id="loginMessage" class="text-center text-sm"></div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2 class="text-xl font-bold mb-6 text-center" data-i18n="register_title">Регистрация</h2>
                <input type="text" id="registerUsername" class="form-input" data-i18n-placeholder="register_username" placeholder="Придумайте логин">
                <input type="password" id="registerPassword" class="form-input" data-i18n-placeholder="register_password" placeholder="Придумайте пароль">
                <input type="password" id="registerConfirmPassword" class="form-input" data-i18n-placeholder="register_confirm_password" placeholder="Повторите пароль">
                <button class="btn-neon w-full mb-4" onclick="register()" data-i18n="register_button">Зарегистрироваться</button>
                <div class="text-center">
                    <p class="text-sm text-gray-400" data-i18n="register_wait_message">После регистрации ожидайте подтверждения администратора</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appScreen" style="display: none;">
        <!-- Avatar (User Icon) with Dropdown -->
        <div class="avatar-container" style="position: fixed; top: 20px; left: 20px; z-index: 100;">
            <div class="avatar" id="userAvatar" onclick="toggleAdminDropdown()">
                <span id="avatarInitials">U</span>
            </div>
            <div id="adminDropdown" class="admin-dropdown" style="display: none;">
                <button class="btn-neon w-full mb-2" onclick="openAdminPanel()" id="adminPanelBtn" style="display: none;" data-i18n="admin_panel_button">Панель администратора</button>
                <button class="btn-secondary w-full" onclick="logout()" data-i18n="logout_button">Выйти</button>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav">
            <div class="logo-badge">
                <div class="logo-mark">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M3 12h6l3-8 3 16 3-8h3" stroke="white" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <div class="app-name" data-i18n="app_title">Hostel Manager</div>
                    <div class="user-role" id="userRoleDisplay" data-i18n="control_panel">Control Panel</div>
                </div>
            </div>

            <div class="nav-tab active" onclick="showTab('rooms')" data-i18n="rooms_tab">Комнаты</div>
            <div class="nav-tab" onclick="showTab('tariffs')" data-i18n="tariffs_tab">Тарифы</div>
            <div class="nav-tab" onclick="showTab('staff')" data-i18n="staff_tab">Персонал</div>
            <div class="nav-tab" onclick="showTab('contact')" data-i18n="contact_tab">Связь</div>
        </nav>

        <main class="relative z-10 pt-24">
            <!-- Rooms Tab -->
            <div id="roomsTab" class="tab-content active">
                <section class="py-12">
                    <div class="max-w-7xl mx-auto px-6 md:px-12">
                        <h1 class="glow-h1 neon-title text-glow mb-2 slide-in" data-i18n="rooms_title">
                            <span>Комнаты</span>
                        </h1>
                        <p class="text-white/80 mb-8 slide-in" style="animation-delay: 0.1s;" data-i18n="rooms_subtitle">Управление настройками системы и конфигурацией комнат</p>

                        <!-- Rooms Editor Section -->
                        <div class="rooms-section">
                            <h2 class="text-2xl font-bold mb-6 text-glow slide-in" style="animation-delay: 0.2s;" data-i18n="rooms_management">Управление комнатами</h2>
                            
                            <!-- Controls -->
                            <div class="editor-controls slide-in" style="animation-delay: 0.3s;" id="roomsEditControls">
                                <button class="btn-neon hover-lift hover-glow" onclick="roomsManager.openModal()" id="addRoomBtn" data-i18n="add_room_button">+ Добавить комнату</button>
                                <button class="icon-btn hover-lift" id="editRoomsBtn" onclick="roomsManager.toggleEditMode()" title="Редактировать комнаты">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="icon-btn danger hover-lift" onclick="roomsManager.resetAllBeds()" title="Сбросить все кровати">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Legend -->
                            <div class="legend slide-in" style="animation-delay: 0.4s;">
                                <span><span class="dot free"></span><span data-i18n="bed_free">Свободно</span></span>
                                <span><span class="dot occupied"></span><span data-i18n="bed_occupied">Занято</span></span>
                            </div>

                            <!-- Stats -->
                            <div class="stats slide-in" style="animation-delay: 0.5s;" id="stats">
                                <span data-i18n="total_beds">Всего мест</span>: 0 · <span data-i18n="free_beds">Свободно</span>: 0 · <span data-i18n="occupied_beds">Занято</span>: 0
                            </div>

                            <!-- Rooms Grid -->
                            <div class="rooms-grid" id="roomsGrid">
                                <!-- Rooms will be generated here -->
                            </div>
                        </div>

                        <!-- Residents List Section -->
                        <div class="residents-section">
                            <div class="flex justify-between items-center mb-6 slide-in" style="animation-delay: 0.6s;">
                                <h2 class="text-2xl font-bold text-glow" data-i18n="residents_list">Список жильцов</h2>
                                <button class="icon-btn hover-lift" onclick="roomsManager.printResidentsList()" title="Распечатать">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 9V2h12v7M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                                        <path d="M6 14h12v8H6z"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="residents-list">
                                <div class="resident-header">
                                    <div data-i18n="resident_number">№</div>
                                    <div data-i18n="resident_name">Имя</div>
                                    <div data-i18n="resident_room">Комната</div>
                                    <div data-i18n="resident_side">Сторона</div>
                                    <div data-i18n="resident_bed">Кровать</div>
                                    <div data-i18n="resident_bed_number">Номер кровати</div>
                                    <div data-i18n="resident_checkin">Дата заезда</div>
                                    <div data-i18n="resident_checkout">Дата выезда</div>
                                    <div data-i18n="resident_source">Источник</div>
                                    <div data-i18n="resident_payment">Оплата</div>
                                    <div data-i18n="resident_amount">Сумма</div>
                                </div>
                                <div id="residentsRows">
                                    <!-- Residents will be generated here -->
                                </div>
                                
                                <!-- Payment Statistics -->
                                <div class="payment-stats" id="paymentStats">
                                    <div class="payment-stat-item hover-lift">
                                        <div class="payment-stat-label" data-i18n="payment_cash">Наличные</div>
                                        <div class="payment-stat-value" id="cashAmount">0</div>
                                    </div>
                                    <div class="payment-stat-item hover-lift">
                                        <div class="payment-stat-label" data-i18n="payment_terminal">Терминал</div>
                                        <div class="payment-stat-value" id="terminalAmount">0</div>
                                    </div>
                                    <div class="payment-stat-item hover-lift">
                                        <div class="payment-stat-label" data-i18n="payment_transfer">Перевод</div>
                                        <div class="payment-stat-value" id="transferAmount">0</div>
                                    </div>
                                    <div class="payment-stat-item payment-stat-total hover-lift">
                                        <div class="payment-stat-label" data-i18n="payment_total">Общая сумма</div>
                                        <div class="payment-stat-value" id="totalAmount">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tariffs Tab -->
            <div id="tariffsTab" class="tab-content">
                <section class="py-12">
                    <div class="max-w-7xl mx-auto px-6 md:px-12 text-center">
                        <h1 class="glow-h1" data-i18n="tariff_title">Тариф JustDoIt</h1>
                        <p class="text-white/80 mb-8" data-i18n="tariff_subtitle">Идеальное решение для комфортного проживания</p>
                        
                        <div class="card-3d" style="border-color: rgba(255,84,191,0.3); display: inline-block; padding: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div style="background: rgba(255,255,255,0.1); color: var(--neon2); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 700; border: 1px solid rgba(0,229,255,0.3);">Beta</div>
                                <div style="background: linear-gradient(90deg, var(--neon3), var(--neon1)); color: #031024; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 700;" data-i18n="tariff_free_days">3 дня бесплатно</div>
                            </div>
                            <h3 class="text-xl font-bold mb-4">JustDoIt</h3>
                            <div style="font-size: 2.5rem; font-weight: 800; background: linear-gradient(90deg, var(--neon3), var(--neon1)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 1rem 0;">50.000 sum</div>
                            <div style="font-size: 0.875rem; color: rgba(255,255,255,0.7); text-align: center; margin-bottom: 1rem;" data-i18n="tariff_per_month">в месяц</div>
                            <button class="btn-neon w-full mt-4" onclick="selectTariff()" data-i18n="tariff_selected">Тариф выбран</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Staff Tab - ИСПРАВЛЕННЫЙ КОНТЕНТ -->
            <div id="staffTab" class="tab-content">
                <section class="py-12">
                    <div class="max-w-7xl mx-auto px-6 md:px-12">
                        <div class="text-center mb-12">
                            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-[#8b5cf6] via-[#a855f7] to-[#c084fc] bg-clip-text text-transparent">
                                Управление персоналом
                            </h1>
                            <p class="text-xl opacity-80 text-purple-200">Отслеживание рабочих дней и расчет заработной платы</p>
                        </div>

                        <!-- Statistics -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
                            <div class="stats-card stats-employees">
                                <div class="stats-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stats-value" id="totalEmployees">0</div>
                                <div class="stats-label">Сотрудников</div>
                            </div>
                            <div class="stats-card stats-days">
                                <div class="stats-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="stats-value" id="totalWorkDays">0</div>
                                <div class="stats-label">Рабочих дней</div>
                            </div>
                            <div class="stats-card stats-salary">
                                <div class="stats-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="stats-value" id="totalSalary">0</div>
                                <div class="stats-label">Общая зарплата</div>
                            </div>
                            <div class="stats-card stats-avg">
                                <div class="stats-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stats-value" id="avgSalary">0</div>
                                <div class="stats-label">Средняя зарплата</div>
                            </div>
                        </div>

                        <!-- Add Employee Form -->
                        <div class="card-3d card-purple mb-12 no-print">
                            <h2 class="text-2xl font-semibold mb-6 flex items-center gap-3">
                                <i class="fas fa-user-plus text-[#c084fc]"></i>
                                Добавить нового сотрудника
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium mb-2 text-purple-200">Имя сотрудника</label>
                                    <input type="text" id="employeeName" class="form-input w-full" placeholder="Например: Алишер">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-purple-200">Должность</label>
                                    <select id="employeePosition" class="form-input w-full">
                                        <option value="admin">Администратор</option>
                                        <option value="manager">Менеджер</option>
                                        <option value="security">Охранник</option>
                                        <option value="cleaner">Техничка</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-purple-200">Зарплата за смену</label>
                                    <input type="number" id="employeeRate" class="form-input w-full" value="120000" min="0">
                                </div>
                                <div class="flex items-end">
                                    <button id="addEmployeeBtn" class="btn-primary w-full h-[56px]">
                                        <i class="fas fa-plus mr-3"></i>Добавить
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Month Navigation with Print Button -->
                        <div class="month-nav">
                            <div class="nav-btn" id="prevMonth">
                                <i class="fas fa-chevron-left"></i>
                            </div>
                            <div class="month-title" id="currentMonth"></div>
                            <div class="nav-btn" id="nextMonth">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="print-btn no-print" id="printBtn" title="Печать отчета">
                                <i class="fas fa-print"></i>
                            </div>
                        </div>

                        <!-- Staff Display -->
                        <div id="staffContainer" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 print-section">
                            <!-- Staff cards will be generated here -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Contact Tab -->
            <div id="contactTab" class="tab-content">
                <section class="py-12">
                    <div class="max-w-7xl mx-auto px-6 md:px-12">
                        <h1 class="glow-h1 mb-2" data-i18n="contact_title">Связь</h1>
                        <p class="text-white/80 mb-8" data-i18n="contact_subtitle">Свяжитесь с нами удобным для вас способом</p>

                        <div class="contact-grid">
                            <!-- Telegram -->
                            <div class="card-3d contact-card">
                                <div class="contact-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="var(--neon1)" stroke-width="2"/>
                                        <path d="M8.5 12.5L10.5 14.5L15.5 9.5" stroke="var(--neon1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <h3 class="contact-title">Telegram</h3>
                                <p class="contact-description" data-i18n="contact_telegram_desc">Быстрая связь через Telegram. Отвечаем в течение нескольких минут.</p>
                                <a href="https://t.me/ali_na_sfe" target="_blank" class="btn-neon" data-i18n="contact_telegram_button">Написать в Telegram</a>
                                <div class="mt-4">
                                    <div class="text-sm opacity-75">@ali_na_sfe</div>
                                    <button class="copy-btn" data-text="@ali_na_sfe" data-i18n="copy_button">Скопировать</button>
                                </div>
                            </div>

                            <!-- WhatsApp -->
                            <div class="card-3d contact-card">
                                <div class="contact-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="var(--neon2)" stroke-width="2"/>
                                        <path d="M8 12H16M12 8V16" stroke="var(--neon2)" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </div>
                                <h3 class="contact-title">WhatsApp</h3>
                                <p class="contact-description" data-i18n="contact_whatsapp_desc">Свяжитесь с нами через WhatsApp для быстрого ответа на ваши вопросы.</p>
                                <a href="https://wa.me/998933564221" target="_blank" class="btn-secondary" data-i18n="contact_whatsapp_button">Написать в WhatsApp</a>
                                <div class="mt-4">
                                    <div class="text-sm opacity-75">+998-93-356-42-21</div>
                                    <button class="copy-btn" data-text="+998-93-356-42-21" data-i18n="copy_button">Скопировать</button>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="card-3d contact-card">
                                <div class="contact-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 4H9L11 9L8.5 10.5C9.57096 12.6715 11.3285 14.429 13.5 15.5L15 13L20 15V19C20 19.5304 19.7893 20.0391 19.4142 20.4142C19.0391 20.7893 18.5304 21 18 21C14.0993 20.763 10.4202 19.1065 7.65683 16.3432C4.8935 13.5798 3.23705 9.90074 3 6C3 5.46957 3.21071 4.96086 3.58579 4.58579C3.96086 4.21071 4.46957 4 5 4Z" stroke="var(--neon3)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <h3 class="contact-title" data-i18n="contact_phone">Телефон</h3>
                                <p class="contact-description" data-i18n="contact_phone_desc">Позвоните нам для получения консультации или бронирования.</p>
                                <a href="tel:+998-93-356-42-21" class="btn-neon" data-i18n="contact_phone_button">Позвонить</a>
                                <div class="mt-4">
                                    <div class="text-sm opacity-75">+998-93-356-42-21</div>
                                    <button class="copy-btn" data-text="+998-93-356-42-21" data-i18n="copy_button">Скопировать</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Rooms Modals -->
    <!-- Add Room Modal -->
    <div id="addRoomModal" class="modal">
        <div class="modal-content card-3d">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" data-i18n="add_room_modal_title">Добавить комнату</h3>
                    <button onclick="roomsManager.closeModal()" class="modal-close" style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">×</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm opacity-75 mb-2" data-i18n="room_number_label">Номер комнаты</label>
                        <input type="number" id="roomNumber" class="form-input" data-i18n-placeholder="room_number_placeholder" placeholder="101" min="1">
                    </div>
                    <div>
                        <label class="block text-sm opacity-75 mb-2" data-i18n="room_name_label">Название комнаты</label>
                        <input type="text" id="roomName" class="form-input" data-i18n-placeholder="room_name_placeholder" placeholder="4-местный dorm">
                    </div>
                    
                    <!-- Левая сторона -->
                    <div class="border border-gray-600 rounded-lg p-4">
                        <label class="block text-sm opacity-75 mb-2" data-i18n="room_left_side">Левая сторона</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_double_beds">Двухъярусные</label>
                                <input type="number" id="leftDoubleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_single_beds">Одинарные</label>
                                <input type="number" id="leftSingleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                        </div>
                    </div>

                    <!-- Правая сторона -->
                    <div class="border border-gray-600 rounded-lg p-4">
                        <label class="block text-sm opacity-75 mb-2" data-i18n="room_right_side">Правая сторона</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_double_beds">Двухъярусные</label>
                                <input type="number" id="rightDoubleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_single_beds">Одинарные</label>
                                <input type="number" id="rightSingleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                        </div>
                    </div>

                    <!-- Центр -->
                    <div class="border border-gray-600 rounded-lg p-4">
                        <label class="block text-sm opacity-75 mb-2" data-i18n="room_center">Центр</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_double_beds">Двухъярусные</label>
                                <input type="number" id="centerDoubleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                            <div>
                                <label class="block text-xs opacity-75 mb-1" data-i18n="room_single_beds">Одинарные</label>
                                <input type="number" id="centerSingleBeds" class="form-input" placeholder="0" min="0" max="5">
                            </div>
                        </div>
                    </div>

                    <button class="btn-neon w-full mt-4" onclick="roomsManager.addNewRoom()" data-i18n="create_room_button">Создать комнату</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Bed Modal -->
    <div id="addBedModal" class="modal">
        <div class="modal-content card-3d">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" data-i18n="add_bed_modal_title">Добавить кровать</h3>
                    <button onclick="roomsManager.closeAddBedModal()" class="modal-close" style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">×</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm opacity-75 mb-2" data-i18n="bed_type_label">Тип кровати</label>
                        <select id="bedType" class="custom-select">
                            <option value="single" data-i18n="bed_single">Одинарная</option>
                            <option value="double" data-i18n="bed_double">Двухъярусная</option>
                        </select>
                    </div>
                    <button class="btn-neon w-full mt-4" onclick="roomsManager.addNewBed()" data-i18n="add_bed_button">Добавить кровать</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resident Modal -->
    <div id="residentModal" class="modal">
        <div class="modal-content card-3d">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" data-i18n="resident_modal_title">Информация о жильце</h3>
                    <button onclick="roomsManager.closeResidentModal()" class="modal-close" style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">×</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm opacity-75 mb-2" data-i18n="resident_name_label">Имя жильца</label>
                        <input type="text" id="residentName" class="form-input" data-i18n-placeholder="resident_name_placeholder" placeholder="Иван Иванов">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm opacity-75 mb-2" data-i18n="resident_checkin_label">Дата заезда</label>
                            <input type="date" id="checkInDate" class="form-input">
                        </div>
                        <div>
                            <label class="block text-sm opacity-75 mb-2" data-i18n="resident_checkout_label">Дата выезда</label>
                            <input type="date" id="checkOutDate" class="form-input">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm opacity-75 mb-2" data-i18n="resident_source_label">Источник</label>
                            <select id="residentSource" class="custom-select">
                                <option value="booking" data-i18n="source_booking">Booking</option>
                                <option value="clinic" data-i18n="source_clinic">Клиника</option>
                                <option value="street" data-i18n="source_street">Улица</option>
                                <option value="other" data-i18n="source_other">Другое</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm opacity-75 mb-2" data-i18n="resident_payment_label">Оплата</label>
                            <select id="residentPayment" class="custom-select">
                                <option value="cash" data-i18n="payment_cash">Наличные</option>
                                <option value="terminal" data-i18n="payment_terminal">Терминал</option>
                                <option value="transfer" data-i18n="payment_transfer">Перевод</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm opacity-75 mb-2" data-i18n="resident_amount_label">Сумма оплаты</label>
                        <input type="text" id="residentAmount" class="form-input" placeholder="0" onblur="roomsManager.formatAmountOnBlur(this)">
                    </div>
                    <div id="residentBedInfo" class="text-sm opacity-75 p-3 bg-gray-800 rounded-lg">
                        <!-- Bed info will be shown here -->
                    </div>
                    <button class="btn-neon w-full mt-4" onclick="roomsManager.saveResident()" data-i18n="save_resident_button">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanelModal" class="modal">
        <div class="modal-content card-3d" style="max-width: 800px;">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold" data-i18n="admin_panel_title">Панель администратора</h2>
                    <button class="icon-btn" onclick="closeAdminPanel()">✕</button>
                </div>
                
                <div class="space-y-6">
                    <div class="user-info-section p-4 bg-white/5 rounded-lg">
                        <h3 class="font-semibold mb-2" data-i18n="admin_user_info">Информация о пользователе</h3>
                        <div class="space-y-2 text-sm">
                            <div data-i18n="admin_user_name">Имя: <span id="adminUserName">Администратор</span></div>
                            <div data-i18n="admin_user_role">Роль: <span id="adminUserRole">Администратор</span></div>
                            <div data-i18n="admin_login_date">Дата входа: <span id="adminLoginDate">Сегодня</span></div>
                        </div>
                    </div>

                    <div class="system-controls">
                        <h3 class="font-semibold mb-4 text-lg" data-i18n="admin_user_management">Управление пользователями</h3>
                        
                        <!-- Pending Users -->
                        <div class="mb-8">
                            <h4 class="font-semibold mb-3 text-lg border-b border-white/10 pb-2" data-i18n="admin_pending_users">Заявки на регистрацию</h4>
                            <div id="adminPendingUsersList" class="space-y-4">
                                <!-- Pending users will be listed here -->
                            </div>
                        </div>

                        <!-- Active Users -->
                        <div class="mb-8">
                            <h4 class="font-semibold mb-3 text-lg border-b border-white/10 pb-2" data-i18n="admin_active_users">Активные пользователи</h4>
                            <div id="adminActiveUsersList" class="space-y-4">
                                <!-- Active users will be listed here -->
                            </div>
                        </div>

                        <!-- Suspended Users -->
                        <div class="suspended-users-section">
                            <h4 class="font-semibold mb-3 text-lg border-b border-white/10 pb-2" data-i18n="admin_suspended_users">Заблокированные пользователи</h4>
                            <div id="adminSuspendedUsersList" class="space-y-4">
                                <!-- Suspended users will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Staff Section Styles from second file */
        @media print {
          body * {
            visibility: hidden;
          }
          .print-section, .print-section * {
            visibility: visible;
          }
          .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
          }
          .no-print {
            display: none !important;
          }
          .card-3d {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
            background: white !important;
            color: black !important;
          }
          .stats-card {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
            background: white !important;
          }
          .day-indicator.worked {
            background: #10b981 !important;
            color: white !important;
            border: 1px solid #10b981 !important;
          }
        }

        /* Background network flow */
        .bg-flow-staff{
          position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden;
          opacity:0.9;
        }
        .flow-path-staff{ 
          stroke-linecap:round; 
          stroke-width:0.8; 
          opacity:0.15; 
          animation:flowMove 20s linear infinite;
          filter: drop-shadow(0 0 4px var(--neon1));
        }
        .flow-path-staff:nth-child(2){ animation-duration:26s; opacity:0.1; }
        .flow-path-staff:nth-child(3){ animation-duration:18s; opacity:0.08; }

        /* Card 3D hover for staff */
        .card-3d-staff{ 
          border-radius:1.25rem; 
          padding:1.5rem; 
          transform-style:preserve-3d; 
          transition:all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
          position:relative;
          overflow:hidden;
          backdrop-filter: blur(10px);
          border: 1px solid;
        }

        .card-3d-staff:hover {
          transform: translateY(-8px) scale(1.02);
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* Different color themes for employees */
        .card-purple { 
          background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(168, 85, 247, 0.08));
          border-color: rgba(139, 92, 246, 0.3);
        }
        .card-purple:hover {
          border-color: rgba(139, 92, 246, 0.6);
          box-shadow: 0 15px 40px rgba(139, 92, 246, 0.25);
        }

        .card-blue { 
          background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(37, 99, 235, 0.08));
          border-color: rgba(59, 130, 246, 0.3);
        }
        .card-blue:hover {
          border-color: rgba(59, 130, 246, 0.6);
          box-shadow: 0 15px 40px rgba(59, 130, 246, 0.25);
        }

        .card-green { 
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(5, 150, 105, 0.08));
          border-color: rgba(16, 185, 129, 0.3);
        }
        .card-green:hover {
          border-color: rgba(16, 185, 129, 0.6);
          box-shadow: 0 15px 40px rgba(16, 185, 129, 0.25);
        }

        .card-pink { 
          background: linear-gradient(135deg, rgba(236, 72, 153, 0.12), rgba(219, 39, 119, 0.08));
          border-color: rgba(236, 72, 153, 0.3);
        }
        .card-pink:hover {
          border-color: rgba(236, 72, 153, 0.6);
          box-shadow: 0 15px 40px rgba(236, 72, 153, 0.25);
        }

        .card-teal { 
          background: linear-gradient(135deg, rgba(20, 184, 166, 0.12), rgba(13, 148, 136, 0.08));
          border-color: rgba(20, 184, 166, 0.3);
        }
        .card-teal:hover {
          border-color: rgba(20, 184, 166, 0.6);
          box-shadow: 0 15px 40px rgba(20, 184, 166, 0.25);
        }

        .card-indigo { 
          background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(79, 70, 229, 0.08));
          border-color: rgba(99, 102, 241, 0.3);
        }
        .card-indigo:hover {
          border-color: rgba(99, 102, 241, 0.6);
          box-shadow: 0 15px 40px rgba(99, 102, 241, 0.25);
        }

        .card-orange { 
          background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(217, 119, 6, 0.08));
          border-color: rgba(245, 158, 11, 0.3);
        }
        .card-orange:hover {
          border-color: rgba(245, 158, 11, 0.6);
          box-shadow: 0 15px 40px rgba(245, 158, 11, 0.25);
        }

        /* Position lines */
        .position-line {
          position: relative;
          padding-left: 2rem;
          margin-bottom: 1.5rem;
        }

        .position-line::before {
          content: '';
          position: absolute;
          left: 0;
          top: 0.5rem;
          bottom: 0.5rem;
          width: 6px;
          border-radius: 3px;
        }

        .position-admin::before { background: linear-gradient(180deg, #8b5cf6, #c084fc); }
        .position-manager::before { background: linear-gradient(180deg, #3b82f6, #60a5fa); }
        .position-security::before { background: linear-gradient(180deg, #ef4444, #f87171); }
        .position-cleaner::before { background: linear-gradient(180deg, #10b981, #34d399); }

        .day-indicator {
          display: inline-block;
          width: 36px;
          height: 36px;
          border-radius: 10px;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
          text-align: center;
          line-height: 34px;
          margin: 0.1rem;
          cursor: pointer;
          transition: all 0.3s;
          font-size: 0.85rem;
          font-weight: 600;
          color: #e9d5ff;
        }

        .day-indicator:hover {
          transform: scale(1.15);
          border-color: currentColor;
          background: rgba(255, 255, 255, 0.2);
        }

        .day-indicator.worked {
          color: white;
          box-shadow: 0 0 20px currentColor;
          transform: scale(1.1);
        }

        /* Different colors for worked days based on card theme */
        .card-purple .day-indicator.worked { background: linear-gradient(135deg, #8b5cf6, #c084fc); border-color: #8b5cf6; }
        .card-blue .day-indicator.worked { background: linear-gradient(135deg, #3b82f6, #60a5fa); border-color: #3b82f6; }
        .card-green .day-indicator.worked { background: linear-gradient(135deg, #10b981, #34d399); border-color: #10b981; }
        .card-pink .day-indicator.worked { background: linear-gradient(135deg, #ec4899, #f472b6); border-color: #ec4899; }
        .card-teal .day-indicator.worked { background: linear-gradient(135deg, #14b8a6, #2dd4bf); border-color: #14b8a6; }
        .card-indigo .day-indicator.worked { background: linear-gradient(135deg, #6366f1, #818cf8); border-color: #6366f1; }
        .card-orange .day-indicator.worked { background: linear-gradient(135deg, #f59e0b, #fbbf24); border-color: #f59e0b; }

        .salary-display {
          font-weight: 700;
          font-size: 1.4rem;
          text-shadow: 0 0 20px currentColor;
        }

        .rate-display {
          font-size: 0.95rem;
          opacity: 0.9;
        }

        /* Blue and neon stats cards */
        .stats-card {
          border-radius: 16px;
          padding: 1.5rem;
          text-align: center;
          backdrop-filter: blur(10px);
          transition: all 0.3s;
          border: 1px solid;
          position: relative;
          overflow: hidden;
        }

        .stats-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
          transition: left 0.5s;
        }

        .stats-card:hover::before {
          left: 100%;
        }

        .stats-card:hover {
          transform: translateY(-8px);
        }

        .stats-employees { 
          background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));
          border-color: rgba(59, 130, 246, 0.5);
          box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        .stats-employees:hover { 
          box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
          border-color: rgba(59, 130, 246, 0.8);
        }

        .stats-days { 
          background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));
          border-color: rgba(59, 130, 246, 0.5);
          box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        .stats-days:hover { 
          box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
          border-color: rgba(59, 130, 246, 0.8);
        }

        .stats-salary { 
          background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));
          border-color: rgba(59, 130, 246, 0.5);
          box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        .stats-salary:hover { 
          box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
          border-color: rgba(59, 130, 246, 0.8);
        }

        .stats-avg { 
          background: linear-gradient(135deg, rgba(0, 229, 255, 0.2), rgba(0, 180, 255, 0.15));
          border-color: rgba(0, 229, 255, 0.5);
          box-shadow: 0 8px 25px rgba(0, 229, 255, 0.3);
          animation: neonGlow 2s ease-in-out infinite alternate;
        }
        .stats-avg:hover { 
          box-shadow: 0 15px 35px rgba(0, 229, 255, 0.5);
          border-color: rgba(0, 229, 255, 0.8);
        }

        @keyframes neonGlow {
          from {
            box-shadow: 0 8px 25px rgba(0, 229, 255, 0.3);
          }
          to {
            box-shadow: 0 8px 30px rgba(0, 229, 255, 0.6), 0 0 15px rgba(0, 229, 255, 0.4);
          }
        }

        .stats-value {
          font-size: 2rem;
          font-weight: 800;
          margin-bottom: 0.5rem;
        }

        .stats-employees .stats-value { 
          background: linear-gradient(135deg, #3b82f6, #60a5fa);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .stats-days .stats-value { 
          background: linear-gradient(135deg, #3b82f6, #60a5fa);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .stats-salary .stats-value { 
          background: linear-gradient(135deg, #3b82f6, #60a5fa);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .stats-avg .stats-value { 
          background: linear-gradient(135deg, #00e5ff, #00b4ff);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
        }

        .stats-label {
          font-size: 0.9rem;
          opacity: 0.9;
          font-weight: 600;
        }

        .stats-employees .stats-label { color: #93c5fd; }
        .stats-days .stats-label { color: #93c5fd; }
        .stats-salary .stats-label { color: #93c5fd; }
        .stats-avg .stats-label { color: #7dd3fc; }

        /* Print button styles */
        .print-btn {
          background: linear-gradient(135deg, #3b82f6, #1d4ed8);
          color: white;
          border: none;
          border-radius: 12px;
          padding: 0.75rem 1.5rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .print-btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }

        .print-btn:active {
          transform: translateY(0);
        }

        /* Month navigation */
        .month-nav {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 1.5rem;
          margin-bottom: 2rem;
        }

        .month-title {
          font-size: 1.5rem;
          font-weight: 700;
          min-width: 220px;
          text-align: center;
          background: linear-gradient(135deg, #8b5cf6, #c084fc);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          padding: 0.75rem 1.5rem;
          border: 1px solid rgba(139, 92, 246, 0.3);
          border-radius: 12px;
          backdrop-filter: blur(10px);
        }

        .nav-btn {
          background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(168, 85, 247, 0.15));
          border: 1px solid rgba(139, 92, 246, 0.4);
          border-radius: 12px;
          width: 44px;
          height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.3s;
          color: #e9d5ff;
        }

        .nav-btn:hover {
          background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(168, 85, 247, 0.25));
          border-color: var(--neon2);
          transform: scale(1.1);
          box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .print-btn {
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.15));
          border: 1px solid rgba(16, 185, 129, 0.4);
          border-radius: 12px;
          width: 44px;
          height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.3s;
          color: #6ee7b7;
        }

        .print-btn:hover {
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.25));
          border-color: #10b981;
          transform: scale(1.1);
          box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .employee-avatar {
          width: 60px;
          height: 60px;
          border-radius: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.4rem;
          font-weight: 700;
          color: white;
          border: 2px solid;
        }

        /* Different avatar colors */
        .avatar-purple { 
          background: linear-gradient(135deg, #8b5cf6, #7c3aed);
          border-color: rgba(139, 92, 246, 0.5);
        }
        .avatar-blue { 
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          border-color: rgba(59, 130, 246, 0.5);
        }
        .avatar-green { 
          background: linear-gradient(135deg, #10b981, #059669);
          border-color: rgba(16, 185, 129, 0.5);
        }
        .avatar-pink { 
          background: linear-gradient(135deg, #ec4899, #db2777);
          border-color: rgba(236, 72, 153, 0.5);
        }
        .avatar-teal { 
          background: linear-gradient(135deg, #14b8a6, #0d9488);
          border-color: rgba(20, 184, 166, 0.5);
        }
        .avatar-indigo { 
          background: linear-gradient(135deg, #6366f1, #4f46e5);
          border-color: rgba(99, 102, 241, 0.5);
        }
        .avatar-orange { 
          background: linear-gradient(135deg, #f59e0b, #d97706);
          border-color: rgba(245, 158, 11, 0.5);
        }

        .empty-state {
          text-align: center;
          padding: 4rem 2rem;
          opacity: 0.8;
        }

        .empty-state i {
          font-size: 4rem;
          margin-bottom: 1.5rem;
          opacity: 0.6;
          background: linear-gradient(135deg, var(--neon1), var(--neon3));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }

        /* Form styles */
        .form-input-staff {
          background: rgba(139, 92, 246, 0.1);
          border: 1px solid rgba(139, 92, 246, 0.3);
          border-radius: 12px;
          padding: 1rem;
          color: #f0e6ff;
          transition: all 0.3s;
          backdrop-filter: blur(10px);
        }

        .form-input-staff:focus {
          outline: none;
          border-color: var(--neon2);
          box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
          background: rgba(139, 92, 246, 0.15);
        }

        .form-input-staff::placeholder {
          color: #c4b5fd;
        }

        .btn-primary {
          background: linear-gradient(135deg, var(--neon1), var(--neon3));
          border: none;
          color: white;
          padding: 1rem 2rem;
          border-radius: 12px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .btn-primary:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
          background: linear-gradient(135deg, var(--neon2), var(--neon4));
        }

        .btn-primary:active {
          transform: translateY(-1px);
        }

        /* Notification */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 1rem 1.5rem;
          border-radius: 12px;
          color: white;
          z-index: 1000;
          transform: translateX(400px);
          transition: transform 0.3s ease;
          backdrop-filter: blur(10px);
          border: 1px solid;
        }

        .notification.show {
          transform: translateX(0);
        }

        .notification.success {
          background: linear-gradient(135deg, rgba(139, 92, 246, 0.9), rgba(168, 85, 247, 0.8));
          border-color: rgba(139, 92, 246, 0.5);
        }

        .notification.error {
          background: linear-gradient(135deg, rgba(248, 113, 113, 0.9), rgba(239, 68, 68, 0.8));
          border-color: rgba(248, 113, 113, 0.5);
        }

        /* Responsive grid for staff */
        .staff-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
          gap: 1.5rem;
          margin-top: 1.5rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          .staff-grid {
            grid-template-columns: 1fr;
          }
          .stats-grid {
            grid-template-columns: repeat(2, 1fr);
          }
        }

        @media (max-width: 480px) {
          .stats-grid {
            grid-template-columns: 1fr;
          }
          .day-indicator {
            width: 32px;
            height: 32px;
            line-height: 30px;
            font-size: 0.8rem;
          }
        }
    </style>

    <script>
        // MULTILINGUAL SUPPORT
        const translations = {
            ru: {
                // Общие
                "app_title": "Hostel Manager",
                "app_subtitle": "Система управления хостелом",
                "control_panel": "Панель управления",
                "logout_button": "Выйти",
                
                // Аутентификация
                "login_tab": "Вход",
                "register_tab": "Регистрация",
                "login_title": "Вход в систему",
                "login_username": "Логин",
                "login_password": "Пароль",
                "login_button": "Войти",
                "register_title": "Регистрация",
                "register_username": "Придумайте логин",
                "register_password": "Придумайте пароль",
                "register_confirm_password": "Повторите пароль",
                "register_button": "Зарегистрироваться",
                "register_wait_message": "После регистрации ожидайте подтверждения администратора",
                
                // Навигация
                "rooms_tab": "Комнаты",
                "tariffs_tab": "Тарифы",
                "staff_tab": "Персонал",
                "contact_tab": "Связь",
                
                // Комнаты
                "rooms_title": "Комнаты",
                "rooms_subtitle": "Управление настройками системы и конфигурацией комнат",
                "rooms_management": "Управление комнатами",
                "add_room_button": "+ Добавить комнату",
                "bed_free": "Свободно",
                "bed_occupied": "Занято",
                "total_beds": "Всего мест",
                "free_beds": "Свободно",
                "occupied_beds": "Занято",
                "residents_list": "Список жильцов",
                "resident_number": "№",
                "resident_name": "Имя",
                "resident_room": "Комната",
                "resident_side": "Сторона",
                "resident_bed": "Кровать",
                "resident_bed_number": "Номер",
                "resident_checkin": "Дата заезда",
                "resident_checkout": "Дата выезда",
                "resident_source": "Источник",
                "resident_payment": "Оплата",
                "resident_amount": "Сумма",
                "payment_cash": "Наличные",
                "payment_terminal": "Терминал",
                "payment_transfer": "Перевод",
                "payment_total": "Общая сумма",
                
                // Модальные окна комнат
                "add_room_modal_title": "Добавить комнату",
                "room_number_label": "Номер комнаты",
                "room_number_placeholder": "101",
                "room_name_label": "Название комнаты",
                "room_name_placeholder": "4-местный dorm",
                "room_left_side": "Левая сторона",
                "room_right_side": "Правая сторона",
                "room_center": "Центр",
                "room_double_beds": "Двухъярусные",
                "room_single_beds": "Одинарные",
                "create_room_button": "Создать комнату",
                "add_bed_modal_title": "Добавить кровать",
                "bed_type_label": "Тип кровати",
                "bed_single": "Одинарная",
                "bed_double": "Двухъярусная",
                "add_bed_button": "Добавить кровать",
                "resident_modal_title": "Информация о жильце",
                "resident_name_label": "Имя жильца",
                "resident_name_placeholder": "Иван Иванов",
                "resident_checkin_label": "Дата заезда",
                "resident_checkout_label": "Дата выезда",
                "resident_source_label": "Источник",
                "source_booking": "Booking",
                "source_clinic": "Клиника",
                "source_street": "Улица",
                "source_other": "Другое",
                "resident_payment_label": "Оплата",
                "resident_amount_label": "Сумма оплаты",
                "save_resident_button": "Сохранить",
                
                // Тарифы
                "tariff_title": "Тариф JustDoIt",
                "tariff_subtitle": "Идеальное решение для комфортного проживания",
                "tariff_free_days": "3 дня бесплатно",
                "tariff_per_month": "в месяц",
                "tariff_selected": "Тариф выбран",
                
                // Персонал
                "staff_title": "Управление персоналом",
                "staff_subtitle": "Отчетность по сменам и расчет заработной платы",
                "staff_today": "Сегодня на смене",
                "staff_admin": "Администратор",
                "staff_cleaner": "Техничка",
                "staff_security": "Охранник",
                "staff_add": "Добавить сотрудника",
                "staff_name_placeholder": "Имя сотрудника",
                "staff_salary_placeholder": "Зарплата в день",
                "staff_add_button": "Добавить",
                "staff_list": "Список сотрудников",
                "staff_salary_calc": "Расчет заработной платы",
                "staff_daily_payments": "Ежедневные выплаты",
                "staff_total_daily": "Итого за день:",
                "staff_period_calc": "Расчет за период",
                "staff_days_placeholder": "Количество дней",
                "staff_calculate_button": "Рассчитать",
                "staff_admin_only": "Раздел доступен администраторам",
                "staff_contact_admin": "Обратитесь к администратору для получения доступа",
                
                // Контакты
                "contact_title": "Связь",
                "contact_subtitle": "Свяжитесь с нами удобным для вас способом",
                "contact_telegram_desc": "Быстрая связь через Telegram. Отвечаем в течение нескольких минут.",
                "contact_telegram_button": "Написать в Telegram",
                "contact_whatsapp_desc": "Свяжитесь с нами через WhatsApp для быстрого ответа на ваши вопросы.",
                "contact_whatsapp_button": "Написать в WhatsApp",
                "contact_phone": "Телефон",
                "contact_phone_desc": "Позвоните нам для получения консультации или бронирования.",
                "contact_phone_button": "Позвонить",
                "copy_button": "Скопировать",
                
                // Админ панель
                "admin_panel_button": "Панель администратора",
                "admin_panel_title": "Панель администратора",
                "admin_user_info": "Информация о пользователе",
                "admin_user_name": "Имя:",
                "admin_user_role": "Роль:",
                "admin_login_date": "Дата входа:",
                "admin_user_management": "Управление пользователями",
                "admin_pending_users": "Заявки на регистрацию",
                "admin_active_users": "Активные пользователи",
                "admin_suspended_users": "Заблокированные пользователи"
            },
            uz: {
                // Общие
                "app_title": "Hostel Manager",
                "app_subtitle": "Hostel boshqaruv tizimi",
                "control_panel": "Boshqaruv paneli",
                "logout_button": "Chiqish",
                
                // Аутентификация
                "login_tab": "Kirish",
                "register_tab": "Ro'yxatdan o'tish",
                "login_title": "Tizimga kirish",
                "login_username": "Login",
                "login_password": "Parol",
                "login_button": "Kiring",
                "register_title": "Ro'yxatdan o'tish",
                "register_username": "Login yarating",
                "register_password": "Parol yarating",
                "register_confirm_password": "Parolni takrorlang",
                "register_button": "Ro'yxatdan o'ting",
                "register_wait_message": "Ro'yxatdan o'tgandan so'ng administrator tasdigini kuting",
                
                // Навигация
                "rooms_tab": "Xonalar",
                "tariffs_tab": "Tariflar",
                "staff_tab": "Xodimlar",
                "contact_tab": "Bog'lanish",
                
                // Комнаты
                "rooms_title": "Xonalar",
                "rooms_subtitle": "Tizim sozlamalari va xona konfiguratsiyasini boshqarish",
                "rooms_management": "Xonalarni boshqarish",
                "add_room_button": "+ Xona qo'shish",
                "bed_free": "Bo'sh",
                "bed_occupied": "Band",
                "total_beds": "Jami joylar",
                "free_beds": "Bo'sh",
                "occupied_beds": "Band",
                "residents_list": "Yashovchilar ro'yxati",
                "resident_number": "№",
                "resident_name": "Ism",
                "resident_room": "Xona",
                "resident_side": "Tomoni",
                "resident_bed": "Karavot",
                "resident_bed_number": "Raqam",
                "resident_checkin": "Kelish sanasi",
                "resident_checkout": "Ketish sanasi",
                "resident_source": "Manba",
                "resident_payment": "To'lov",
                "resident_amount": "Summa",
                "payment_cash": "Naqd",
                "payment_terminal": "Terminal",
                "payment_transfer": "O'tkazma",
                "payment_total": "Jami summa",
                
                // Модальные окна комнат
                "add_room_modal_title": "Xona qo'shish",
                "room_number_label": "Xona raqami",
                "room_number_placeholder": "101",
                "room_name_label": "Xona nomi",
                "room_name_placeholder": "4 kishilik xona",
                "room_left_side": "Chap tomon",
                "room_right_side": "O'ng tomon",
                "room_center": "Markaz",
                "room_double_beds": "Ikki qavatli",
                "room_single_beds": "Bir qavatli",
                "create_room_button": "Xona yaratish",
                "add_bed_modal_title": "Karavot qo'shish",
                "bed_type_label": "Karavot turi",
                "bed_single": "Bir qavatli",
                "bed_double": "Ikki qavatli",
                "add_bed_button": "Karavot qo'shish",
                "resident_modal_title": "Yashovchi haqida ma'lumot",
                "resident_name_label": "Yashovchi ismi",
                "resident_name_placeholder": "Ali Valiyev",
                "resident_checkin_label": "Kelish sanasi",
                "resident_checkout_label": "Ketish sanasi",
                "resident_source_label": "Manba",
                "source_booking": "Booking",
                "source_clinic": "Klinika",
                "source_street": "Ko'cha",
                "source_other": "Boshqa",
                "resident_payment_label": "To'lov",
                "resident_amount_label": "To'lov summasi",
                "save_resident_button": "Saqlash",
                
                // Тарифы
                "tariff_title": "JustDoIt tarifi",
                "tariff_subtitle": "Qulay yashash uchun mukammal yechim",
                "tariff_free_days": "3 kun bepul",
                "tariff_per_month": "oyiga",
                "tariff_selected": "Tarif tanlandi",
                
                // Персонал
                "staff_title": "Xodimlarni boshqarish",
                "staff_subtitle": "Smenalar hisoboti va ish haqini hisoblash",
                "staff_today": "Bugun smenada",
                "staff_admin": "Administrator",
                "staff_cleaner": "Texnik xodim",
                "staff_security": "Qorovul",
                "staff_add": "Xodim qo'shish",
                "staff_name_placeholder": "Xodim ismi",
                "staff_salary_placeholder": "Kunlik ish haqi",
                "staff_add_button": "Qo'shish",
                "staff_list": "Xodimlar ro'yxati",
                "staff_salary_calc": "Ish haqini hisoblash",
                "staff_daily_payments": "Kunlik to'lovlar",
                "staff_total_daily": "Kunlik jami:",
                "staff_period_calc": "Davr bo'yicha hisoblash",
                "staff_days_placeholder": "Kunlar soni",
                "staff_calculate_button": "Hisoblash",
                "staff_admin_only": "Bo'lim faqat administratorlar uchun",
                "staff_contact_admin": "Kirish uchun administratorga murojaat qiling",
                
                // Контакты
                "contact_title": "Bog'lanish",
                "contact_subtitle": "Biz bilan qulay usulda bog'laning",
                "contact_telegram_desc": "Telegram orqali tez aloqa. Bir necha daqiqa ichida javob beramiz.",
                "contact_telegram_button": "Telegramda yozish",
                "contact_whatsapp_desc": "Savollaringizga tez javob olish uchun WhatsApp orqali biz bilan bog'laning.",
                "contact_whatsapp_button": "WhatsAppda yozish",
                "contact_phone": "Telefon",
                "contact_phone_desc": "Maslahat olish yoki bron qilish uchun bizga qo'ng'iroq qiling.",
                "contact_phone_button": "Qo'ng'iroq qilish",
                "copy_button": "Nusxalash",
                
                // Админ панель
                "admin_panel_button": "Administrator paneli",
                "admin_panel_title": "Administrator paneli",
                "admin_user_info": "Foydalanuvchi ma'lumoti",
                "admin_user_name": "Ism:",
                "admin_user_role": "Rol:",
                "admin_login_date": "Kirish sanasi:",
                "admin_user_management": "Foydalanuvchilarni boshqarish",
                "admin_pending_users": "Ro'yxatdan o'tish so'rovlari",
                "admin_active_users": "Faol foydalanuvchilar",
                "admin_suspended_users": "Bloklangan foydalanuvchilar"
            },
            en: {
                // Общие
                "app_title": "Hostel Manager",
                "app_subtitle": "Hostel management system",
                "control_panel": "Control Panel",
                "logout_button": "Logout",
                
                // Аутентификация
                "login_tab": "Login",
                "register_tab": "Register",
                "login_title": "Login to system",
                "login_username": "Username",
                "login_password": "Password",
                "login_button": "Login",
                "register_title": "Registration",
                "register_username": "Create username",
                "register_password": "Create password",
                "register_confirm_password": "Confirm password",
                "register_button": "Register",
                "register_wait_message": "After registration, wait for administrator confirmation",
                
                // Навигация
                "rooms_tab": "Rooms",
                "tariffs_tab": "Tariffs",
                "staff_tab": "Staff",
                "contact_tab": "Contact",
                
                // Комнаты
                "rooms_title": "Rooms",
                "rooms_subtitle": "System settings and room configuration management",
                "rooms_management": "Room Management",
                "add_room_button": "+ Add Room",
                "bed_free": "Free",
                "bed_occupied": "Occupied",
                "total_beds": "Total beds",
                "free_beds": "Free",
                "occupied_beds": "Occupied",
                "residents_list": "Residents List",
                "resident_number": "No.",
                "resident_name": "Name",
                "resident_room": "Room",
                "resident_side": "Side",
                "resident_bed": "Bed",
                "resident_bed_number": "Number",
                "resident_checkin": "Check-in Date",
                "resident_checkout": "Check-out Date",
                "resident_source": "Source",
                "resident_payment": "Payment",
                "resident_amount": "Amount",
                "payment_cash": "Cash",
                "payment_terminal": "Terminal",
                "payment_transfer": "Transfer",
                "payment_total": "Total Amount",
                
                // Модальные окна комнат
                "add_room_modal_title": "Add Room",
                "room_number_label": "Room Number",
                "room_number_placeholder": "101",
                "room_name_label": "Room Name",
                "room_name_placeholder": "4-bed dorm",
                "room_left_side": "Left Side",
                "room_right_side": "Right Side",
                "room_center": "Center",
                "room_double_beds": "Double Beds",
                "room_single_beds": "Single Beds",
                "create_room_button": "Create Room",
                "add_bed_modal_title": "Add Bed",
                "bed_type_label": "Bed Type",
                "bed_single": "Single",
                "bed_double": "Double",
                "add_bed_button": "Add Bed",
                "resident_modal_title": "Resident Information",
                "resident_name_label": "Resident Name",
                "resident_name_placeholder": "John Smith",
                "resident_checkin_label": "Check-in Date",
                "resident_checkout_label": "Check-out Date",
                "resident_source_label": "Source",
                "source_booking": "Booking",
                "source_clinic": "Clinic",
                "source_street": "Street",
                "source_other": "Other",
                "resident_payment_label": "Payment",
                "resident_amount_label": "Payment Amount",
                "save_resident_button": "Save",
                
                // Тарифы
                "tariff_title": "JustDoIt Tariff",
                "tariff_subtitle": "Perfect solution for comfortable living",
                "tariff_free_days": "3 days free",
                "tariff_per_month": "per month",
                "tariff_selected": "Tariff Selected",
                
                // Персонал
                "staff_title": "Staff Management",
                "staff_subtitle": "Shift reporting and salary calculation",
                "staff_today": "Today on Shift",
                "staff_admin": "Administrator",
                "staff_cleaner": "Cleaner",
                "staff_security": "Security",
                "staff_add": "Add Staff Member",
                "staff_name_placeholder": "Staff Name",
                "staff_salary_placeholder": "Salary per day",
                "staff_add_button": "Add",
                "staff_list": "Staff List",
                "staff_salary_calc": "Salary Calculation",
                "staff_daily_payments": "Daily Payments",
                "staff_total_daily": "Total per day:",
                "staff_period_calc": "Period Calculation",
                "staff_days_placeholder": "Number of days",
                "staff_calculate_button": "Calculate",
                "staff_admin_only": "Section available to administrators only",
                "staff_contact_admin": "Contact administrator for access",
                
                // Контакты
                "contact_title": "Contact",
                "contact_subtitle": "Contact us in a convenient way for you",
                "contact_telegram_desc": "Quick communication via Telegram. We respond within minutes.",
                "contact_telegram_button": "Write in Telegram",
                "contact_whatsapp_desc": "Contact us via WhatsApp for quick answers to your questions.",
                "contact_whatsapp_button": "Write in WhatsApp",
                "contact_phone": "Phone",
                "contact_phone_desc": "Call us for consultation or booking.",
                "contact_phone_button": "Call",
                "copy_button": "Copy",
                
                // Админ панель
                "admin_panel_button": "Admin Panel",
                "admin_panel_title": "Admin Panel",
                "admin_user_info": "User Information",
                "admin_user_name": "Name:",
                "admin_user_role": "Role:",
                "admin_login_date": "Login Date:",
                "admin_user_management": "User Management",
                "admin_pending_users": "Registration Requests",
                "admin_active_users": "Active Users",
                "admin_suspended_users": "Suspended Users"
            }
        };

        let currentLanguage = 'ru';

        function changeLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('currentLang').textContent = lang.toUpperCase();
            
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update all elements with data-i18n-placeholder attribute
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            
            // Update options in selects
            document.querySelectorAll('select option[data-i18n]').forEach(option => {
                const key = option.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    option.textContent = translations[lang][key];
                }
            });
            
            // Update resident header labels for mobile
            if (window.innerWidth <= 768) {
                const labels = [
                    'resident_number', 'resident_name', 'resident_room', 'resident_side', 
                    'resident_bed', 'resident_bed_number', 'resident_checkin', 'resident_checkout', 
                    'resident_source', 'resident_payment', 'resident_amount'
                ];
                
                document.querySelectorAll('.resident-header > div, .resident-row > div').forEach((div, index) => {
                    if (index < labels.length) {
                        div.setAttribute('data-label', translations[lang][labels[index]] || labels[index]);
                    }
                });
            }
            
            closeLanguageDropdown();
        }

        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function closeLanguageDropdown() {
            document.getElementById('languageDropdown').style.display = 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const languageBtn = document.getElementById('languageBtn');
            const languageDropdown = document.getElementById('languageDropdown');
            
            if (!languageBtn.contains(event.target) && languageDropdown && !languageDropdown.contains(event.target)) {
                closeLanguageDropdown();
            }
        });

        // AUTHENTICATION SYSTEM
        const LANGUAGE_KEY = "hostel_language";
        let currentUser = null;

        // Load saved language
        const savedLanguage = localStorage.getItem(LANGUAGE_KEY);
        if (savedLanguage) {
            currentLanguage = savedLanguage;
            changeLanguage(savedLanguage);
        }

        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.style.display = 'none');
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('loginForm').style.display = 'block';
            } else {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('registerForm').style.display = 'block';
            }
        }

        async function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!username || !password) {
                alert(currentLanguage === 'ru' ? 'Заполните все поля' : 
                      currentLanguage === 'uz' ? 'Barcha maydonlarni to\'ldiring' : 
                      'Fill in all fields');
                return;
            }

            if (password !== confirmPassword) {
                alert(currentLanguage === 'ru' ? 'Пароли не совпадают' : 
                      currentLanguage === 'uz' ? 'Parollar mos kelmadi' : 
                      'Passwords do not match');
                return;
            }

            try {
                // Используем backend API для регистрации
                const result = await API.register(username, password);
                
                alert(currentLanguage === 'ru' ? 'Регистрация успешна! Ожидайте подтверждения администратора.' : 
                      currentLanguage === 'uz' ? 'Ro\'yxatdan o\'tish muvaffaqiyatli! Administrator tasdigini kuting.' : 
                      'Registration successful! Wait for administrator confirmation.');
                showAuthTab('login');
                
                // Clear form
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerConfirmPassword').value = '';
            } catch (error) {
                console.error('Registration error:', error);
                alert(currentLanguage === 'ru' ? `Ошибка регистрации: ${error.message}` : 
                      currentLanguage === 'uz' ? `Ro'yxatdan o'tish xatosi: ${error.message}` : 
                      `Registration error: ${error.message}`);
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const messageEl = document.getElementById('loginMessage');

            if (!username || !password) {
                alert(currentLanguage === 'ru' ? 'Введите логин и пароль' : 
                      currentLanguage === 'uz' ? 'Login va parolni kiriting' : 
                      'Enter username and password');
                return;
            }

            try {
                messageEl.textContent = currentLanguage === 'ru' ? 'Вход...' : 
                                       currentLanguage === 'uz' ? 'Kirish...' : 
                                       'Logging in...';
                messageEl.style.color = '#00e5ff';

                // Используем backend API для входа
                const result = await API.login(username, password);
                
                // Проверка статуса пользователя
                if (result.status === 'pending') {
                    messageEl.textContent = 
                        currentLanguage === 'ru' ? 'Аккаунт ожидает подтверждения администратора' : 
                        currentLanguage === 'uz' ? 'Hisob administrator tasdigini kutmoqda' : 
                        'Account is waiting for administrator confirmation';
                    messageEl.style.color = '#ffa502';
                    return;
                }

                if (result.status === 'expired') {
                    messageEl.textContent = 
                        currentLanguage === 'ru' ? 'Срок действия аккаунта истек' : 
                        currentLanguage === 'uz' ? 'Hisob muddati tugagan' : 
                        'Account has expired';
                    messageEl.style.color = '#ff4757';
                    return;
                }

                if (result.status === 'suspended') {
                    messageEl.textContent = 
                        currentLanguage === 'ru' ? 'Аккаунт заблокирован администратором' : 
                        currentLanguage === 'uz' ? 'Hisob administrator tomonidan bloklangan' : 
                        'Account is suspended by administrator';
                    messageEl.style.color = '#ff4757';
                    return;
                }

                // Успешный вход - сохраняем токен (уже сохранен в API.login)
                currentUser = {
                    username: result.username,
                    role: result.role
                };

                localStorage.setItem('current_user', JSON.stringify(currentUser));
                messageEl.textContent = '';
                showApplication();
            } catch (error) {
                console.error('Login error:', error);
                messageEl.textContent = 
                    currentLanguage === 'ru' ? `Ошибка входа: ${error.message}` : 
                    currentLanguage === 'uz' ? `Kirish xatosi: ${error.message}` : 
                    `Login error: ${error.message}`;
                messageEl.style.color = '#ff4757';
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('current_user');
            localStorage.removeItem('auth_token'); // Удаляем токен
            
            // Сбрасываем флаг загрузки персонала для повторной загрузки при входе
            staffDataLoaded = false;
            staffData = {};
            
            document.getElementById('appScreen').style.display = 'none';
            document.getElementById('authScreen').style.display = 'flex';
            closeAdminDropdown();
            
            // Clear login form
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginMessage').textContent = '';
        }

        async function showApplication() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            
            // Update user info
            document.getElementById('userRoleDisplay').textContent = currentUser.role === 'admin' ? 
                (currentLanguage === 'ru' ? 'Admin Panel' : 
                 currentLanguage === 'uz' ? 'Admin Panel' : 
                 'Admin Panel') : 
                (currentLanguage === 'ru' ? 'User Panel' : 
                 currentLanguage === 'uz' ? 'User Panel' : 
                 'User Panel');
            document.getElementById('avatarInitials').textContent = currentUser.username.substring(0, 2).toUpperCase();
            
            // Show/hide admin features
            const isAdmin = currentUser.role === 'admin';
            
            // ВСЕГДА показываем вкладку Персонал всем пользователям
            const staffTab = document.querySelector('.nav-tab[onclick="showTab(\'staff\')"]');
            if (staffTab) {
                staffTab.style.display = 'block';
            }
            
            // Для администраторов показываем полную панель управления персоналом
            document.getElementById('adminPanelBtn').style.display = isAdmin ? 'block' : 'none';
            
            // Кнопки управления комнатами показываем ВСЕМ пользователям
            document.getElementById('addRoomBtn').style.display = 'block';
            document.getElementById('editRoomsBtn').style.display = 'block';
            
            const dangerBtn = document.querySelector('.icon-btn.danger');
            if (dangerBtn) {
                dangerBtn.style.display = 'block';
            }
            
            // Initialize rooms management
            console.log('🔄 Инициализация roomsManager...');
            await roomsManager.init();
            console.log('✅ roomsManager инициализирован!');
            
            // Initialize staff management
            console.log('🔄 Инициализация staff management...');
            await initializeStaffManagement();
            console.log('✅ Staff management инициализирован!');
        }

        // Admin Dropdown functionality
        function toggleAdminDropdown() {
            const dropdown = document.getElementById('adminDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function closeAdminDropdown() {
            document.getElementById('adminDropdown').style.display = 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const avatar = document.getElementById('userAvatar');
            const dropdown = document.getElementById('adminDropdown');
            const adminModal = document.getElementById('adminPanelModal');
            const languageBtn = document.getElementById('languageBtn');
            const languageDropdown = document.getElementById('languageDropdown');
            
            if (!avatar.contains(event.target) && dropdown && !dropdown.contains(event.target)) {
                closeAdminDropdown();
            }
            
            if (!languageBtn.contains(event.target) && languageDropdown && !languageDropdown.contains(event.target)) {
                closeLanguageDropdown();
            }
            
            if (event.target === adminModal) {
                closeAdminPanel();
            }
        });

        // Admin Panel functionality
        function openAdminPanel() {
            document.getElementById('adminPanelModal').style.display = 'block';
            closeAdminDropdown();
            
            // Update admin panel info
            document.getElementById('adminUserName').textContent = currentUser.username;
            document.getElementById('adminUserRole').textContent = currentUser.role === 'admin' ? 
                (currentLanguage === 'ru' ? 'Администратор' : 
                 currentLanguage === 'uz' ? 'Administrator' : 
                 'Administrator') : 
                (currentLanguage === 'ru' ? 'Пользователь' : 
                 currentLanguage === 'uz' ? 'Foydalanuvchi' : 
                 'User');
            document.getElementById('adminLoginDate').textContent = new Date().toLocaleDateString();
            
            // Load users lists
            loadAdminPendingUsers();
            loadAdminActiveUsers();
            loadAdminSuspendedUsers();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanelModal').style.display = 'none';
        }

        // STAFF MANAGEMENT SYSTEM
        let staffData = {};
        let currentDate = luxon.DateTime.now();
        let staffDataLoaded = false;

        // Color themes for employees
        const colorThemes = [
            { card: 'card-purple', avatar: 'avatar-purple', salary: '#8b5cf6' },
            { card: 'card-blue', avatar: 'avatar-blue', salary: '#3b82f6' },
            { card: 'card-green', avatar: 'avatar-green', salary: '#10b981' },
            { card: 'card-pink', avatar: 'avatar-pink', salary: '#ec4899' },
            { card: 'card-teal', avatar: 'avatar-teal', salary: '#14b8a6' },
            { card: 'card-indigo', avatar: 'avatar-indigo', salary: '#6366f1' },
            { card: 'card-orange', avatar: 'avatar-orange', salary: '#f59e0b' }
        ];

        // Position settings
        const positionSettings = {
            admin: { 
                title: 'Администратор', 
                colorClass: 'position-admin',
                icon: 'fas fa-user-tie'
            },
            manager: { 
                title: 'Менеджер', 
                colorClass: 'position-manager',
                icon: 'fas fa-briefcase'
            },
            security: { 
                title: 'Охранник', 
                colorClass: 'position-security',
                icon: 'fas fa-shield-alt'
            },
            cleaner: { 
                title: 'Техничка', 
                colorClass: 'position-cleaner',
                icon: 'fas fa-broom'
            }
        };

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU').format(amount);
        }

        // Get color theme for employee
        function getEmployeeColorTheme(employeeId) {
            const employeeIds = Object.keys(staffData);
            const index = employeeIds.indexOf(employeeId);
            return colorThemes[index % colorThemes.length];
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Print function
        function printReport() {
            showNotification('Подготовка к печати...', 'success');
            setTimeout(() => {
                window.print();
            }, 1000);
        }

        // Load staff data from backend
        async function loadStaffData() {
            if (staffDataLoaded) return;
            
            const token = localStorage.getItem('auth_token');
            if (!token || typeof API === 'undefined') {
                // Загружаем из localStorage
                console.log('📁 Загрузка персонала из localStorage...');
                staffData = JSON.parse(localStorage.getItem('hostelStaff')) || {};
                staffDataLoaded = true;
                return;
            }
            
            try {
                console.log('📥 Загрузка персонала с сервера через API...');
                const result = await API.getStaff();
                
                if (result && typeof result === 'object') {
                    staffData = result;
                    staffDataLoaded = true;
                    console.log('✅ Персонал загружен с сервера! Сотрудников:', Object.keys(staffData).length);
                } else {
                    // Fallback to localStorage
                    console.log('📁 Сервер вернул пустые данные, загрузка из localStorage...');
                    staffData = JSON.parse(localStorage.getItem('hostelStaff')) || {};
                    staffDataLoaded = true;
                }
            } catch (error) {
                console.error('❌ Ошибка загрузки персонала:', error.message);
                // Fallback to localStorage
                staffData = JSON.parse(localStorage.getItem('hostelStaff')) || {};
                staffDataLoaded = true;
            }
        }
        
        // Initialize staff management
        async function initializeStaffManagement() {
            await loadStaffData();
            updateMonthDisplay();
            renderStaff();
            updateStatistics();
            
            // Add employee button event
            const addEmployeeBtn = document.getElementById('addEmployeeBtn');
            if (addEmployeeBtn) {
                addEmployeeBtn.addEventListener('click', addEmployee);
            }
            
            // Month navigation
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            const printBtn = document.getElementById('printBtn');
            
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', () => {
                    currentDate = currentDate.minus({ months: 1 });
                    updateMonthDisplay();
                    renderStaff();
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', () => {
                    currentDate = currentDate.plus({ months: 1 });
                    updateMonthDisplay();
                    renderStaff();
                });
            }

            // Print button event
            if (printBtn) {
                printBtn.addEventListener('click', printReport);
            }
            
            // Enter key support
            const employeeNameInput = document.getElementById('employeeName');
            if (employeeNameInput) {
                employeeNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') addEmployee();
                });
            }
        }

        // Update month display
        function updateMonthDisplay() {
            const currentMonthElement = document.getElementById('currentMonth');
            if (currentMonthElement) {
                currentMonthElement.textContent = currentDate.toFormat('LLLL yyyy');
            }
        }

        // Add a new employee
        async function addEmployee() {
            const nameInput = document.getElementById('employeeName');
            const positionSelect = document.getElementById('employeePosition');
            const rateInput = document.getElementById('employeeRate');
            
            if (!nameInput || !positionSelect || !rateInput) return;
            
            const name = nameInput.value.trim();
            const position = positionSelect.value;
            const rate = parseInt(rateInput.value);
            
            if (!name) {
                showNotification('Введите имя сотрудника', 'error');
                nameInput.focus();
                return;
            }
            
            if (isNaN(rate) || rate <= 0) {
                showNotification('Введите корректную зарплату за смену', 'error');
                rateInput.focus();
                return;
            }
            
            // Generate unique ID
            const employeeId = Date.now().toString();
            
            const employeeData = {
                name: name,
                position: position,
                rate: rate,
                workedDays: {}
            };
            
            staffData[employeeId] = employeeData;
            
            // Сохраняем на сервер
            const token = localStorage.getItem('auth_token');
            if (token && typeof API !== 'undefined') {
                try {
                    await API.createStaff(employeeData);
                    console.log('✅ Сотрудник добавлен на сервер');
                } catch (error) {
                    console.error('❌ Ошибка добавления на сервер:', error.message);
                }
            }
            
            await saveStaffData();
            renderStaff();
            updateStatistics();
            
            // Clear name input only
            nameInput.value = '';
            nameInput.focus();
            
            showNotification('Сотрудник успешно добавлен!', 'success');
        }

        // Toggle worked day for employee
        function toggleWorkedDay(employeeId, day) {
            const monthKey = currentDate.toFormat('yyyy-MM');
            if (!staffData[employeeId].workedDays[monthKey]) {
                staffData[employeeId].workedDays[monthKey] = [];
            }
            
            const workedDays = staffData[employeeId].workedDays[monthKey];
            const dayIndex = workedDays.indexOf(day);
            
            if (dayIndex === -1) {
                workedDays.push(day);
            } else {
                workedDays.splice(dayIndex, 1);
            }
            
            saveStaffData();
            renderStaff();
            updateStatistics();
        }

        // Remove employee
        async function removeEmployee(employeeId) {
            const employeeName = staffData[employeeId].name;
            if (confirm(`Удалить сотрудника ${employeeName}?`)) {
                delete staffData[employeeId];
                
                // Удаляем с сервера
                const token = localStorage.getItem('auth_token');
                if (token && typeof API !== 'undefined') {
                    try {
                        await API.deleteStaff(employeeId);
                        console.log('✅ Сотрудник удален с сервера');
                    } catch (error) {
                        console.error('❌ Ошибка удаления с сервера:', error.message);
                    }
                }
                
                await saveStaffData();
                renderStaff();
                updateStatistics();
                showNotification('Сотрудник удален', 'success');
            }
        }

        // Save staff data to backend API
        async function saveStaffData() {
            // Сохраняем в localStorage как резервную копию
            localStorage.setItem('hostelStaff', JSON.stringify(staffData));
            
            const token = localStorage.getItem('auth_token');
            if (!token || typeof API === 'undefined') {
                console.warn('⚠️ Нет токена или API, сохранено только в localStorage');
                return;
            }
            
            try {
                // Отправляем весь объект staffData
                for (const [employeeId, employeeData] of Object.entries(staffData)) {
                    await API.updateStaff(employeeId, employeeData);
                }
                console.log('✅ Персонал сохранен на сервер!');
            } catch (error) {
                console.error('❌ Ошибка сохранения персонала:', error.message);
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalEmployees = Object.keys(staffData).length;
            let totalWorkDays = 0;
            let totalSalary = 0;
            let totalRates = 0;
            
            const monthKey = currentDate.toFormat('yyyy-MM');
            
            Object.values(staffData).forEach(employee => {
                const workedDays = employee.workedDays[monthKey] || [];
                totalWorkDays += workedDays.length;
                totalSalary += workedDays.length * employee.rate;
                totalRates += employee.rate;
            });
            
            const avgSalary = totalEmployees > 0 ? Math.round(totalRates / totalEmployees) : 0;
            
            const totalEmployeesElement = document.getElementById('totalEmployees');
            const totalWorkDaysElement = document.getElementById('totalWorkDays');
            const totalSalaryElement = document.getElementById('totalSalary');
            const avgSalaryElement = document.getElementById('avgSalary');
            
            if (totalEmployeesElement) totalEmployeesElement.textContent = totalEmployees;
            if (totalWorkDaysElement) totalWorkDaysElement.textContent = totalWorkDays;
            if (totalSalaryElement) totalSalaryElement.textContent = formatCurrency(totalSalary);
            if (avgSalaryElement) avgSalaryElement.textContent = formatCurrency(avgSalary);
        }

        // Render all staff
        function renderStaff() {
            const container = document.getElementById('staffContainer');
            if (!container) return;
            
            if (Object.keys(staffData).length === 0) {
                container.innerHTML = `
                    <div class="col-span-3">
                        <div class="empty-state card-3d card-purple">
                            <i class="fas fa-users"></i>
                            <div class="text-2xl font-semibold mb-3 text-purple-200">Нет сотрудников</div>
                            <div class="text-lg opacity-80 text-purple-300">Добавьте первого сотрудника с помощью формы выше</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // Generate days for current month
            const daysInMonth = currentDate.daysInMonth;
            const monthDays = Array.from({length: daysInMonth}, (_, i) => i + 1);
            const monthKey = currentDate.toFormat('yyyy-MM');
            
            for (const [employeeId, data] of Object.entries(staffData)) {
                const position = positionSettings[data.position];
                const workedDays = data.workedDays[monthKey] || [];
                const totalDays = workedDays.length;
                const totalSalary = totalDays * data.rate;
                const initials = data.name.split(' ').map(n => n[0]).join('').toUpperCase();
                const colorTheme = getEmployeeColorTheme(employeeId);
                
                html += `
                    <div class="card-3d-staff position-line ${position.colorClass} ${colorTheme.card}">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div class="employee-avatar ${colorTheme.avatar}">
                                    ${initials}
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white mb-1">${data.name}</h3>
                                    <p class="opacity-90 flex items-center gap-2" style="color: ${colorTheme.salary}">
                                        <i class="${position.icon}"></i>${position.title}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right no-print">
                                <button onclick="removeEmployee('${employeeId}')" class="text-red-300 hover:text-red-200 transition-colors p-3 rounded-xl hover:bg-red-500/10 border border-red-500/20">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-semibold text-lg" style="color: ${colorTheme.salary}">Рабочие дни:</h4>
                                <span class="text-sm opacity-90" style="color: ${colorTheme.salary}">${totalDays} из ${daysInMonth}</span>
                            </div>
                            <div class="flex flex-wrap gap-1">
                                ${monthDays.map(day => `
                                    <div class="day-indicator ${workedDays.includes(day) ? 'worked' : ''}" 
                                         onclick="toggleWorkedDay('${employeeId}', ${day})">
                                        ${day}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-6 border-t border-white/20">
                            <div>
                                <div class="rate-display" style="color: ${colorTheme.salary}">${formatCurrency(data.rate)} за смену</div>
                            </div>
                            <div class="text-right">
                                <div class="salary-display" style="color: ${colorTheme.salary}">${formatCurrency(totalSalary)}</div>
                                <div class="text-sm opacity-80 mt-1" style="color: ${colorTheme.salary}">за месяц</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // USER MANAGEMENT FUNCTIONS
        async function loadAdminPendingUsers() {
            const pendingList = document.getElementById('adminPendingUsersList');
            if (!pendingList) return;
            
            pendingList.innerHTML = '<p class="text-center">Загрузка...</p>';
            
            try {
                const result = await API.getUsers();
                const allUsers = result.users || {};
                pendingList.innerHTML = '';
                
                Object.entries(allUsers).forEach(([username, userData]) => {
                    if (userData.status === 'pending') {
                        const userCard = document.createElement('div');
                        userCard.className = 'user-card';
                        userCard.innerHTML = `
                            <div class="user-header">
                                <div class="user-info">
                                    <div class="user-name">
                                        ${username}
                                        <span class="status-badge status-pending">${currentLanguage === 'ru' ? 'Ожидает' : currentLanguage === 'uz' ? 'Kutmoqda' : 'Pending'}</span>
                                    </div>
                                    <div class="user-email">${currentLanguage === 'ru' ? 'Логин:' : currentLanguage === 'uz' ? 'Login:' : 'Login:'} ${username}</div>
                                    <div class="user-date">${currentLanguage === 'ru' ? 'Зарегистрирован:' : currentLanguage === 'uz' ? 'Ro\'yxatdan o\'tgan:' : 'Registered:'} ${new Date(userData.createdAt).toLocaleDateString()}</div>
                                </div>
                                <div class="user-actions">
                                    <button class="btn-success" onclick="approveUser('${username}')">${currentLanguage === 'ru' ? 'Одобрить' : currentLanguage === 'uz' ? 'Tasdiqlash' : 'Approve'}</button>
                                    <button class="btn-secondary" onclick="rejectUser('${username}')">${currentLanguage === 'ru' ? 'Отклонить' : currentLanguage === 'uz' ? 'Rad etish' : 'Reject'}</button>
                                </div>
                            </div>
                        `;
                        pendingList.appendChild(userCard);
                    }
                });

                if (pendingList.children.length === 0) {
                    pendingList.innerHTML = `<p class="text-gray-400 text-center">${currentLanguage === 'ru' ? 'Нет пользователей ожидающих подтверждения' : currentLanguage === 'uz' ? 'Tasdiqni kutayotgan foydalanuvchilar yo\'q' : 'No users waiting for confirmation'}</p>`;
                }
            } catch (error) {
                console.error('Error loading pending users:', error);
                pendingList.innerHTML = `<p class="text-red-400 text-center">${currentLanguage === 'ru' ? 'Ошибка загрузки' : 'Error loading users'}</p>`;
            }
        }

        async function loadAdminActiveUsers() {
            const activeList = document.getElementById('adminActiveUsersList');
            if (!activeList) return;
            
            activeList.innerHTML = '<p class="text-center">Загрузка...</p>';
            
            try {
                const result = await API.getUsers();
                const allUsers = result.users || {};
                activeList.innerHTML = '';
                
                Object.entries(allUsers).forEach(([username, userData]) => {
                if (userData.status === 'active' && userData.role !== 'admin') {
                    const isExpired = userData.accessExpires && new Date(userData.accessExpires) < new Date();
                    const statusClass = isExpired ? 'status-expired' : 'status-active';
                    const statusText = isExpired ? 
                        (currentLanguage === 'ru' ? 'Истек' : currentLanguage === 'uz' ? 'Muddati tugagan' : 'Expired') : 
                        (currentLanguage === 'ru' ? 'Активен' : currentLanguage === 'uz' ? 'Faol' : 'Active');
                    
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.innerHTML = `
                        <div class="user-header">
                            <div class="user-info">
                                <div class="user-name">
                                    ${username}
                                    <span class="status-badge ${statusClass}">${statusText}</span>
                                </div>
                                <div class="user-email">${currentLanguage === 'ru' ? 'Логин:' : currentLanguage === 'uz' ? 'Login:' : 'Login:'} ${username}</div>
                                <div class="user-email">${currentLanguage === 'ru' ? 'Жильцов:' : currentLanguage === 'uz' ? 'Yashovchilar:' : 'Residents:'} ${userData.residentsCount || 0}</div>
                                <div class="user-date">
                                    ${userData.accessExpires ? 
                                        `${currentLanguage === 'ru' ? 'Доступ до:' : currentLanguage === 'uz' ? 'Gacha kirish:' : 'Access until:'} ${new Date(userData.accessExpires).toLocaleDateString()}` : 
                                        (currentLanguage === 'ru' ? 'Бессрочный доступ' : currentLanguage === 'uz' ? 'Muddatsiz kirish' : 'Unlimited access')}
                                </div>
                                <div class="user-date">${currentLanguage === 'ru' ? 'Зарегистрирован:' : currentLanguage === 'uz' ? 'Ro\'yxatdan o\'tgan:' : 'Registered:'} ${new Date(userData.createdAt).toLocaleDateString()}</div>
                            </div>
                            <div class="user-actions">
                                <div class="access-controls">
                                    <input type="date" id="adminAccessDate-${username}" class="access-date" placeholder="${currentLanguage === 'ru' ? 'Срок доступа' : currentLanguage === 'uz' ? 'Kirish muddati' : 'Access term'}">
                                    <button class="btn-warning" onclick="extendAccess('${username}')">${currentLanguage === 'ru' ? 'Продлить' : currentLanguage === 'uz' ? 'Uzatish' : 'Extend'}</button>
                                    <button class="btn-secondary" onclick="suspendUser('${username}')">${currentLanguage === 'ru' ? 'Заблокировать' : currentLanguage === 'uz' ? 'Bloklash' : 'Suspend'}</button>
                                    ${username !== 'Kvv' ? `<button class="btn-secondary" onclick="deleteUser('${username}')">${currentLanguage === 'ru' ? 'Удалить' : currentLanguage === 'uz' ? 'O\'chirish' : 'Delete'}</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    activeList.appendChild(userCard);
                }
                });

                if (activeList.children.length === 0) {
                    activeList.innerHTML = `<p class="text-gray-400 text-center">${currentLanguage === 'ru' ? 'Нет активных пользователей' : currentLanguage === 'uz' ? 'Faol foydalanuvchilar yo\'q' : 'No active users'}</p>`;
                }
            } catch (error) {
                console.error('Error loading active users:', error);
                activeList.innerHTML = `<p class="text-red-400 text-center">${currentLanguage === 'ru' ? 'Ошибка загрузки' : 'Error loading users'}</p>`;
            }
        }

        async function loadAdminSuspendedUsers() {
            const suspendedList = document.getElementById('adminSuspendedUsersList');
            if (!suspendedList) return;
            
            suspendedList.innerHTML = '<p class="text-center">Загрузка...</p>';
            
            try {
                const result = await API.getUsers();
                const allUsers = result.users || {};
                suspendedList.innerHTML = '';
                let hasSuspendedUsers = false;
                
                Object.entries(allUsers).forEach(([username, userData]) => {
                if (userData.status === 'suspended') {
                    hasSuspendedUsers = true;
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.innerHTML = `
                        <div class="user-header">
                            <div class="user-info">
                                <div class="user-name">
                                    ${username}
                                    <span class="status-badge status-suspended">${currentLanguage === 'ru' ? 'Заблокирован' : currentLanguage === 'uz' ? 'Bloklangan' : 'Suspended'}</span>
                                </div>
                                <div class="user-email">${currentLanguage === 'ru' ? 'Логин:' : currentLanguage === 'uz' ? 'Login:' : 'Login:'} ${username}</div>
                                <div class="user-date">${currentLanguage === 'ru' ? 'Зарегистрирован:' : currentLanguage === 'uz' ? 'Ro\'yxatdan o\'tgan:' : 'Registered:'} ${new Date(userData.createdAt).toLocaleDateString()}</div>
                                <div class="user-date">${currentLanguage === 'ru' ? 'Заблокирован:' : currentLanguage === 'uz' ? 'Bloklangan:' : 'Suspended:'} ${userData.suspendedAt ? new Date(userData.suspendedAt).toLocaleDateString() : (currentLanguage === 'ru' ? 'Неизвестно' : currentLanguage === 'uz' ? 'Noma\'lum' : 'Unknown')}</div>
                            </div>
                            <div class="user-actions">
                                <button class="btn-success" onclick="restoreUser('${username}')">${currentLanguage === 'ru' ? 'Восстановить' : currentLanguage === 'uz' ? 'Tiklash' : 'Restore'}</button>
                                <button class="btn-secondary" onclick="deleteUser('${username}')">${currentLanguage === 'ru' ? 'Удалить' : currentLanguage === 'uz' ? 'O\'chirish' : 'Delete'}</button>
                            </div>
                        </div>
                    `;
                    suspendedList.appendChild(userCard);
                }
                });

                if (!hasSuspendedUsers) {
                    suspendedList.innerHTML = `
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                            <p>${currentLanguage === 'ru' ? 'Нет заблокированных пользователей' : currentLanguage === 'uz' ? 'Bloklangan foydalanuvchilar yo\'q' : 'No suspended users'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading suspended users:', error);
                suspendedList.innerHTML = `<p class="text-red-400 text-center">${currentLanguage === 'ru' ? 'Ошибка загрузки' : 'Error loading users'}</p>`;
            }
        }

        async function approveUser(username) {
            if (confirm(`${currentLanguage === 'ru' ? 'Одобрить пользователя' : currentLanguage === 'uz' ? 'Foydalanuvchini tasdiqlash' : 'Approve user'} ${username}?`)) {
                try {
                    // Set default access for 30 days
                    const expiryDate = new Date();
                    expiryDate.setDate(expiryDate.getDate() + 30);
                    
                    await API.updateUser(username, {
                        status: 'active',
                        accessExpires: expiryDate.toISOString().split('T')[0]
                    });
                    
                    loadAdminPendingUsers();
                    loadAdminActiveUsers();
                    loadAdminSuspendedUsers();
                    alert(currentLanguage === 'ru' ? 'Пользователь одобрен!' : currentLanguage === 'uz' ? 'Foydalanuvchi tasdiqlandi!' : 'User approved!');
                } catch (error) {
                    console.error('Error approving user:', error);
                    alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
                }
            }
        }

        async function rejectUser(username) {
            if (confirm(`${currentLanguage === 'ru' ? 'Отклонить пользователя' : currentLanguage === 'uz' ? 'Foydalanuvchini rad etish' : 'Reject user'} ${username}?`)) {
                try {
                    await API.deleteUser(username);
                    loadAdminPendingUsers();
                    loadAdminActiveUsers();
                    loadAdminSuspendedUsers();
                    alert(currentLanguage === 'ru' ? 'Пользователь отклонен!' : currentLanguage === 'uz' ? 'Foydalanuvchi rad etildi!' : 'User rejected!');
                } catch (error) {
                    console.error('Error rejecting user:', error);
                    alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
                }
            }
        }

        async function restoreUser(username) {
            if (confirm(`${currentLanguage === 'ru' ? 'Восстановить пользователя' : currentLanguage === 'uz' ? 'Foydalanuvchini tiklash' : 'Restore user'} ${username}?`)) {
                try {
                    await API.updateUser(username, { status: 'active' });
                    loadAdminActiveUsers();
                    loadAdminSuspendedUsers();
                    alert(`${currentLanguage === 'ru' ? 'Пользователь' : currentLanguage === 'uz' ? 'Foydalanuvchi' : 'User'} ${username} ${currentLanguage === 'ru' ? 'восстановлен!' : currentLanguage === 'uz' ? 'tiklandi!' : 'restored!'}`);
                } catch (error) {
                    console.error('Error restoring user:', error);
                    alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
                }
            }
        }

        async function extendAccess(username) {
            const dateInput = document.getElementById(`adminAccessDate-${username}`);
            const newDate = dateInput.value;
            
            if (!newDate) {
                alert(currentLanguage === 'ru' ? 'Выберите дату окончания доступа' : 
                      currentLanguage === 'uz' ? 'Kirish muddatini tanlang' : 
                      'Select access expiration date');
                return;
            }

            if (new Date(newDate) <= new Date()) {
                alert(currentLanguage === 'ru' ? 'Дата должна быть в будущем' : 
                      currentLanguage === 'uz' ? 'Sana kelajakda bo\'lishi kerak' : 
                      'Date must be in the future');
                return;
            }

            try {
                await API.updateUser(username, {
                    accessExpires: newDate,
                    status: 'active'
                });
                loadAdminActiveUsers();
                alert(`${currentLanguage === 'ru' ? 'Доступ для' : currentLanguage === 'uz' ? 'Uchun kirish' : 'Access for'} ${username} ${currentLanguage === 'ru' ? 'продлен до' : currentLanguage === 'uz' ? 'gacha uzaytirildi' : 'extended until'} ${newDate}`);
                dateInput.value = '';
            } catch (error) {
                console.error('Error extending access:', error);
                alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
            }
        }

        async function suspendUser(username) {
            if (confirm(`${currentLanguage === 'ru' ? 'Заблокировать пользователя' : currentLanguage === 'uz' ? 'Foydalanuvchini bloklash' : 'Suspend user'} ${username}?`)) {
                try {
                    await API.updateUser(username, {
                        status: 'suspended',
                        suspendedAt: new Date().toISOString()
                    });
                    loadAdminActiveUsers();
                    loadAdminSuspendedUsers();
                    alert(currentLanguage === 'ru' ? 'Пользователь заблокирован!' : currentLanguage === 'uz' ? 'Foydalanuvchi bloklandi!' : 'User suspended!');
                } catch (error) {
                    console.error('Error suspending user:', error);
                    alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
                }
            }
        }

        async function deleteUser(username) {
            if (username === 'Kvv') {
                alert(currentLanguage === 'ru' ? 'Нельзя удалить главного администратора' : 
                      currentLanguage === 'uz' ? 'Bosh administratorni o\'chirib bo\'lmaydi' : 
                      'Cannot delete main administrator');
                return;
            }
            
            if (confirm(`${currentLanguage === 'ru' ? 'Удалить пользователя' : currentLanguage === 'uz' ? 'Foydalanuvchini o\'chirish' : 'Delete user'} ${username}?`)) {
                try {
                    await API.deleteUser(username);
                    loadAdminActiveUsers();
                    loadAdminSuspendedUsers();
                    
                    // If current user was deleted, log them out
                    if (currentUser && currentUser.username === username) {
                        logout();
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert(currentLanguage === 'ru' ? `Ошибка: ${error.message}` : `Error: ${error.message}`);
                }
            }
        }

        // TARIFF FUNCTION
        function selectTariff() {
            alert(currentLanguage === 'ru' ? 'Тариф "JustDoIt" выбран! Цена: 50.000 sum в месяц' : 
                  currentLanguage === 'uz' ? '"JustDoIt" tarifi tanlandi! Narxi: 50.000 sum oyiga' : 
                  'Tariff "JustDoIt" selected! Price: 50.000 sum per month');
        }

        // Update residents count when resident is added/removed
        async function updateUserResidentsCount() {
            if (!currentUser) return;
            
            const userResidents = roomsManager.residents.filter(resident => {
                return true;
            }).length;
            
            try {
                await API.updateUser(currentUser.username, {
                    residentsCount: userResidents
                });
            } catch (error) {
                console.error('Error updating residents count:', error);
            }
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activate selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Activate tab button
            event.target.classList.add('active');
        }

        // Check if user is already logged in
        async function checkAuthentication() {
            const savedUser = localStorage.getItem('current_user');
            const authToken = localStorage.getItem('auth_token');
            
            // Если есть и пользователь и токен, показываем приложение
            if (savedUser && authToken) {
                currentUser = JSON.parse(savedUser);
                await showApplication();
            } else {
                // Если нет токена или пользователя, очищаем данные
                localStorage.removeItem('current_user');
                localStorage.removeItem('auth_token');
            }
        }

        // ROOMS MANAGEMENT SYSTEM  
        var roomsManager = {
            // Configuration
            ROOMS_KEY: "hostel_rooms_config_v12",
            BEDS_STATE_KEY: "hostel_beds_state_v12",
            RESIDENTS_KEY: "hostel_residents_v12",
            BED_NUMBERS_KEY: "hostel_bed_numbers_v12",

            // Default configuration
            roomsConfig: [],

            bedsState: {},
            residents: [],
            bedNumbers: {},
            currentEditingBed: null,
            isEditMode: false,
            currentAddingBedSide: null,
            dragSrcEl: null,

            init: async function() {
                await this.loadFromStorage();
                this.renderRooms();
                this.renderResidents();
                this.updateStats();
                this.calculatePaymentStats();
                updateUserResidentsCount();
            },

            // Format amount only when user leaves the field
            formatAmountOnBlur: function(input) {
                let value = input.value.trim();
                
                if (value === '') {
                    input.value = '';
                    return;
                }
                
                // Remove all non-digit characters
                let cleanValue = value.replace(/\D/g, '');
                
                if (cleanValue === '') {
                    input.value = '';
                    return;
                }
                
                // Convert to number and format
                let numericValue = parseInt(cleanValue);
                input.value = numericValue.toLocaleString('ru-RU');
            },

            // Parse formatted amount back to number
            parseFormattedAmount: function(formattedAmount) {
                if (!formattedAmount) return 0;
                return parseInt(formattedAmount.replace(/\D/g, '')) || 0;
            },

            // Format amount for display
            formatAmountForDisplay: function(amount) {
                if (!amount && amount !== 0) return '';
                return amount.toLocaleString('ru-RU');
            },

            // Calculate payment statistics
            calculatePaymentStats: function() {
                let cashTotal = 0;
                let terminalTotal = 0;
                let transferTotal = 0;
                let overallTotal = 0;

                this.residents.forEach(resident => {
                    const amount = resident.amount || 0;
                    overallTotal += amount;

                    switch (resident.payment) {
                        case 'cash':
                            cashTotal += amount;
                            break;
                        case 'terminal':
                            terminalTotal += amount;
                            break;
                        case 'transfer':
                            transferTotal += amount;
                            break;
                    }
                });

                // Update DOM
                document.getElementById('cashAmount').textContent = this.formatAmountForDisplay(cashTotal);
                document.getElementById('terminalAmount').textContent = this.formatAmountForDisplay(terminalTotal);
                document.getElementById('transferAmount').textContent = this.formatAmountForDisplay(transferTotal);
                document.getElementById('totalAmount').textContent = this.formatAmountForDisplay(overallTotal);
            },

            // Storage functions
            loadFromStorage: async function() {
                let loadedFromServer = false;
                const token = localStorage.getItem('auth_token');
                
                if (token && typeof API !== 'undefined') {
                    try {
                        console.log('📥 Загрузка комнат с сервера через API...');
                        const roomsData = await API.getRooms();
                        
                        console.log('📦 Полученные данные с сервера:', roomsData);
                        
                        // Backend возвращает: {rooms: [], bedsState: {}, residents: [], bedNumbers: {}}
                        if (roomsData && typeof roomsData === 'object') {
                            // Проверяем что это правильная структура
                            if ('rooms' in roomsData) {
                                this.roomsConfig = Array.isArray(roomsData.rooms) ? roomsData.rooms : [];
                                this.bedsState = roomsData.bedsState || {};
                                this.residents = Array.isArray(roomsData.residents) ? roomsData.residents : [];
                                this.bedNumbers = roomsData.bedNumbers || {};
                                loadedFromServer = true;
                                console.log('✅ Загружены данные с сервера! Комнат:', this.roomsConfig.length, 'Жильцов:', this.residents.length);
                            } else {
                                console.log('📭 Сервер вернул данные в неожиданном формате:', roomsData);
                            }
                        } else {
                            console.log('📭 Сервер вернул пустые данные или неправильный формат');
                        }
                    } catch (error) {
                        console.warn('⚠️ Не удалось загрузить с сервера:', error.message);
                    }
                }
                
                // Если не удалось загрузить с сервера, используем localStorage
                if (!loadedFromServer) {
                    console.log('📁 Загрузка из localStorage...');
                    const savedConfig = localStorage.getItem(this.ROOMS_KEY);
                    const savedState = localStorage.getItem(this.BEDS_STATE_KEY);
                    const savedResidents = localStorage.getItem(this.RESIDENTS_KEY);
                    const savedBedNumbers = localStorage.getItem(this.BED_NUMBERS_KEY);
                    
                    if (savedConfig) {
                        this.roomsConfig = JSON.parse(savedConfig);
                    } else {
                        // Create default room if no rooms exist
                        this.roomsConfig = [
                            { 
                                number: 1, 
                                name: "4-местный dorm", 
                                sides: { 
                                    left: { beds: [
                                        { type: 'double', id: 'default_double_1' },
                                        { type: 'single', id: 'default_single_1' }
                                    ] },
                                    right: { beds: [
                                        { type: 'double', id: 'default_double_2' },
                                        { type: 'single', id: 'default_single_2' }
                                    ] },
                                    center: { beds: [] }
                                } 
                            }
                        ];
                        this.saveToStorage();
                    }
                    if (savedState) {
                        this.bedsState = JSON.parse(savedState);
                    }
                    if (savedResidents) {
                        this.residents = JSON.parse(savedResidents);
                    }
                    if (savedBedNumbers) {
                        this.bedNumbers = JSON.parse(savedBedNumbers);
                    }
                }
                
                // Инициализация номеров для всех существующих кроватей
                this.initializeBedNumbers();
            },
            
            initializeBedNumbers: function() {
                let updated = false;
                
                this.roomsConfig.forEach(room => {
                    ['left', 'right', 'center'].forEach(side => {
                        if (room.sides[side] && room.sides[side].beds) {
                            room.sides[side].beds.forEach((bed, bedIndex) => {
                                if (bed.type === 'double') {
                                    const topKey = `${room.number}:${side}:${bedIndex}:top`;
                                    const bottomKey = `${room.number}:${side}:${bedIndex}:bottom`;
                                    
                                    if (!this.bedNumbers[topKey]) {
                                        this.bedNumbers[topKey] = String((bedIndex * 2) + 1);
                                        updated = true;
                                    }
                                    if (!this.bedNumbers[bottomKey]) {
                                        this.bedNumbers[bottomKey] = String((bedIndex * 2) + 2);
                                        updated = true;
                                    }
                                } else {
                                    const singleKey = `${room.number}:${side}:${bedIndex}:single`;
                                    
                                    if (!this.bedNumbers[singleKey]) {
                                        this.bedNumbers[singleKey] = String(bedIndex + 1);
                                        updated = true;
                                    }
                                }
                            });
                        }
                    });
                });
                
                if (updated) {
                    this.saveToStorage();
                }
            },

            saveToStorage: async function() {
                // Также сохраняем в localStorage как резервную копию (сначала!)
                localStorage.setItem(this.ROOMS_KEY, JSON.stringify(this.roomsConfig));
                localStorage.setItem(this.BEDS_STATE_KEY, JSON.stringify(this.bedsState));
                localStorage.setItem(this.RESIDENTS_KEY, JSON.stringify(this.residents));
                localStorage.setItem(this.BED_NUMBERS_KEY, JSON.stringify(this.bedNumbers));
                updateUserResidentsCount();
                
                // Сохраняем на сервер через API
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    console.warn('⚠️ Нет токена, сохранено только в localStorage');
                    return;
                }
                
                if (typeof API === 'undefined') {
                    console.warn('⚠️ API не загружен, сохранено только в localStorage');
                    return;
                }
                
                try {
                    const roomsData = {
                        rooms: this.roomsConfig,
                        bedsState: this.bedsState,
                        residents: this.residents,
                        bedNumbers: this.bedNumbers
                    };
                    
                    console.log('💾 Отправка на сервер через API:', {
                        комнат: this.roomsConfig.length,
                        жильцов: this.residents.length
                    });
                    
                    await API.createRoom(roomsData);
                    console.log('✅ Комнаты сохранены на сервер!');
                } catch (error) {
                    console.error('❌ Ошибка сохранения на сервер:', error.message);
                }
            },

            // Edit mode toggle
            toggleEditMode: function() {
                this.isEditMode = !this.isEditMode;
                const editBtn = document.getElementById('editRoomsBtn');
                
                if (this.isEditMode) {
                    editBtn.classList.add('active');
                    document.querySelectorAll('.room-card').forEach(card => {
                        card.classList.add('editing');
                    });
                } else {
                    editBtn.classList.remove('active');
                    document.querySelectorAll('.room-card').forEach(card => {
                        card.classList.remove('editing');
                    });
                }
                
                this.renderRooms();
            },

            // Room rendering
            renderRooms: function() {
                const grid = document.getElementById('roomsGrid');
                grid.innerHTML = '';

                if (this.roomsConfig.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-white/50 text-lg">${currentLanguage === 'ru' ? 'Нет комнат' : currentLanguage === 'uz' ? 'Xonalar yo\'q' : 'No rooms'}</div>
                            <div class="text-white/30 text-sm mt-2">${currentLanguage === 'ru' ? 'Добавьте первую комнату используя кнопку выше' : currentLanguage === 'uz' ? 'Yuqoridagi tugmadan foydalanib birinchi xonani qo\'shing' : 'Add the first room using the button above'}</div>
                        </div>
                    `;
                    return;
                }

                this.roomsConfig.forEach(room => {
                    const roomEl = document.createElement('div');
                    roomEl.className = `card-3d room-card ${this.isEditMode ? 'editing' : ''}`;
                    
                    // Room header
                    const header = document.createElement('div');
                    header.className = 'room-header';
                    
                    const roomTitle = document.createElement('div');
                    roomTitle.className = 'room-title';
                    
                    if (this.isEditMode) {
                        // В режиме редактирования делаем название редактируемым
                        roomTitle.innerHTML = `
                            <span>${currentLanguage === 'ru' ? 'Комната' : currentLanguage === 'uz' ? 'Xona' : 'Room'} ${room.number} - </span>
                            <input type="text" class="room-name-input" value="${room.name}" 
                                   onchange="roomsManager.updateRoomName(${room.number}, this.value)"
                                   onclick="event.stopPropagation()"
                                   style="background: rgba(255,255,255,0.1); border: 1px solid rgba(124,77,255,0.5); 
                                          border-radius: 4px; padding: 2px 6px; color: white; min-width: 150px;">
                        `;
                    } else {
                        roomTitle.textContent = `${currentLanguage === 'ru' ? 'Комната' : currentLanguage === 'uz' ? 'Xona' : 'Room'} ${room.number} - ${room.name}`;
                    }
                    
                    header.appendChild(roomTitle);
                    
                    if (this.isEditMode) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'modal-close text-red-400 hover:text-red-300';
                        deleteBtn.textContent = '×';
                        deleteBtn.onclick = () => this.deleteRoom(room.number);
                        header.appendChild(deleteBtn);
                    }
                    
                    // Room layout
                    const layout = document.createElement('div');
                    layout.className = 'room-layout';
                    
                    const hasLeft = room.sides.left.beds.length > 0;
                    const hasRight = room.sides.right.beds.length > 0;
                    const hasCenter = room.sides.center.beds.length > 0;
                    
                    // Если есть левые или правые кровати - создаем строку с двумя колонками
                    if (hasLeft || hasRight || this.isEditMode) {
                        const sidesRow = document.createElement('div');
                        sidesRow.className = 'sides-row';
                        
                        // Левая сторона
                        const leftSide = this.createSideSection('left', room.sides.left, room.number);
                        sidesRow.appendChild(leftSide);
                        
                        // Правая сторона
                        const rightSide = this.createSideSection('right', room.sides.right, room.number);
                        sidesRow.appendChild(rightSide);
                        
                        layout.appendChild(sidesRow);
                    }
                    
                    // Центральные кровати (полная ширина)
                    if (hasCenter || this.isEditMode) {
                        const centerSection = this.createSideSection('center', room.sides.center, room.number);
                        centerSection.className += ' full-width';
                        layout.appendChild(centerSection);
                    }
                    
                    roomEl.appendChild(header);
                    roomEl.appendChild(layout);
                    grid.appendChild(roomEl);
                });
            },

            createSideSection: function(side, sideData, roomNumber) {
                const sideSection = document.createElement('div');
                sideSection.className = 'side-section';
                sideSection.dataset.side = side;
                sideSection.dataset.room = roomNumber;
                
                const title = document.createElement('div');
                title.className = 'side-title';
                title.textContent = this.getSideTitle(side);
                
                const bedsContainer = document.createElement('div');
                bedsContainer.className = 'beds-container';
                
                // Добавляем кровати в порядке их добавления
                sideData.beds.forEach((bed, index) => {
                    const bedElement = this.createBed(roomNumber, side, index, bed.type, bed.id);
                    bedsContainer.appendChild(bedElement);
                });
                
                // Кнопка добавления кровати (только в режиме редактирования)
                if (this.isEditMode) {
                    const addBedBtn = document.createElement('div');
                    addBedBtn.className = 'add-bed-btn';
                    addBedBtn.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        <span>${currentLanguage === 'ru' ? 'Добавить кровать' : currentLanguage === 'uz' ? 'Karavot qo\'shish' : 'Add bed'}</span>
                    `;
                    addBedBtn.onclick = () => this.openAddBedModal(roomNumber, side);
                    bedsContainer.appendChild(addBedBtn);
                }
                
                // Drag and drop events
                if (this.isEditMode) {
                    sideSection.addEventListener('dragover', this.handleDragOver.bind(this));
                    sideSection.addEventListener('dragenter', this.handleDragEnter.bind(this));
                    sideSection.addEventListener('dragleave', this.handleDragLeave.bind(this));
                    sideSection.addEventListener('drop', this.handleDrop.bind(this));
                }
                
                sideSection.appendChild(title);
                sideSection.appendChild(bedsContainer);
                return sideSection;
            },

            getSideTitle: function(side) {
                const titles = {
                    left: currentLanguage === 'ru' ? 'Левая сторона' : currentLanguage === 'uz' ? 'Chap tomon' : 'Left side',
                    right: currentLanguage === 'ru' ? 'Правая сторона' : currentLanguage === 'uz' ? 'O\'ng tomon' : 'Right side', 
                    center: currentLanguage === 'ru' ? 'Центр' : currentLanguage === 'uz' ? 'Markaz' : 'Center'
                };
                return titles[side] || side;
            },

            createBed: function(roomNumber, side, bedIndex, bedType, bedId) {
                const bed = document.createElement('div');
                bed.className = `bed ${bedType} ${this.isEditMode ? 'editable' : ''}`;
                bed.draggable = this.isEditMode;
                bed.dataset.room = roomNumber;
                bed.dataset.side = side;
                bed.dataset.index = bedIndex;
                bed.dataset.type = bedType;
                bed.dataset.id = bedId;
                
                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '×';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    this.deleteBed(roomNumber, side, bedIndex);
                };
                
                const bunk = document.createElement('div');
                bunk.className = 'bunk';
                
                if (bedType === 'double') {
                    // Двухъярусная кровать - верх и низ
                    const top = this.createBedPart(currentLanguage === 'ru' ? 'Верх' : currentLanguage === 'uz' ? 'Yuqori' : 'Top', roomNumber, side, bedIndex, 'top', 'double', bedId);
                    const bottom = this.createBedPart(currentLanguage === 'ru' ? 'Низ' : currentLanguage === 'uz' ? 'Pastki' : 'Bottom', roomNumber, side, bedIndex, 'bottom', 'double', bedId);
                    bunk.appendChild(top);
                    bunk.appendChild(bottom);
                } else {
                    // Одинарная кровать - одна часть
                    const single = this.createBedPart(currentLanguage === 'ru' ? 'Одинарная' : currentLanguage === 'uz' ? 'Bir qavatli' : 'Single', roomNumber, side, bedIndex, 'single', 'single', bedId);
                    bunk.appendChild(single);
                }
                
                bed.appendChild(deleteBtn);
                bed.appendChild(bunk);
                
                // Drag events
                if (this.isEditMode) {
                    bed.addEventListener('dragstart', this.handleDragStart.bind(this));
                    bed.addEventListener('dragend', this.handleDragEnd.bind(this));
                }
                
                return bed;
            },

            createBedPart: function(label, roomNumber, side, bedIndex, level, bedType, bedId) {
                const part = document.createElement('div');
                part.className = `bed-part ${bedType}`;
                
                const stateId = `${roomNumber}:${side}:${bedIndex}:${level}:${bedType}:${bedId}`;
                const currentState = this.bedsState[stateId] || 0;
                part.dataset.state = currentState;
                part.dataset.id = stateId;
                
                // Добавляем номер кровати
                const bedNumber = this.createBedNumber(stateId, roomNumber, side, bedIndex, level, bedType);
                part.appendChild(bedNumber);
                
                // Создаем контейнер для текста
                const textContainer = document.createElement('div');
                textContainer.style.display = 'flex';
                textContainer.style.flexDirection = 'column';
                textContainer.style.alignItems = 'center';
                
                const mainText = document.createElement('div');
                mainText.textContent = label;
                
                const residentInfo = document.createElement('div');
                residentInfo.className = 'resident-info';
                
                // Находим жильца для этой кровати
                const resident = this.residents.find(r => r.bedId === stateId);
                if (resident) {
                    residentInfo.textContent = resident.name;
                }
                
                textContainer.appendChild(mainText);
                textContainer.appendChild(residentInfo);
                part.appendChild(textContainer);
                
                if (!this.isEditMode) {
                    part.addEventListener('click', () => {
                        this.currentEditingBed = stateId;
                        this.openResidentModal(stateId, roomNumber, side, bedIndex, level, bedType, resident);
                    });
                }
                
                return part;
            },

            createBedNumber: function(stateId, roomNumber, side, bedIndex, level, bedType) {
                const bedNumber = document.createElement('div');
                const bedNumberKey = `${roomNumber}:${side}:${bedIndex}:${level}`;
                
                // Проверяем наличие номера (не создаем автоматически)
                const hasNumber = this.bedNumbers[bedNumberKey] !== null && this.bedNumbers[bedNumberKey] !== undefined;
                
                // В обычном режиме не показываем пустые номера
                if (!hasNumber && !this.isEditMode) {
                    bedNumber.style.display = 'none';
                    return bedNumber;
                }
                
                bedNumber.className = `bed-number ${this.isEditMode ? 'editable' : ''} ${!hasNumber ? 'empty' : ''}`;
                bedNumber.dataset.bedNumberKey = bedNumberKey;
                
                if (hasNumber) {
                    // Создаем span для номера
                    const numberSpan = document.createElement('span');
                    numberSpan.textContent = this.bedNumbers[bedNumberKey];
                    bedNumber.appendChild(numberSpan);
                    
                    if (this.isEditMode) {
                        // Добавляем кнопку удаления
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'bed-number-remove';
                        removeBtn.innerHTML = '×';
                        removeBtn.onclick = (e) => {
                            e.stopPropagation();
                            this.removeBedNumber(bedNumberKey);
                        };
                        bedNumber.appendChild(removeBtn);
                        
                        // Клик на номер для редактирования
                        numberSpan.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.editBedNumber(bedNumber, bedNumberKey);
                        });
                    }
                } else {
                    // Пустой номер в режиме редактирования - показываем +
                    bedNumber.textContent = '+';
                    bedNumber.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.editBedNumber(bedNumber, bedNumberKey);
                    });
                }
                
                return bedNumber;
            },

            removeBedNumber: function(bedNumberKey) {
                delete this.bedNumbers[bedNumberKey];
                this.saveToStorage();
                this.renderRooms();
            },

            editBedNumber: function(bedNumberElement, bedNumberKey) {
                const currentNumber = this.bedNumbers[bedNumberKey] || '';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'bed-number-input';
                input.value = currentNumber;
                input.maxLength = 7;
                input.placeholder = '№';
                
                bedNumberElement.innerHTML = '';
                bedNumberElement.appendChild(input);
                input.focus();
                input.select();
                
                const saveNumber = () => {
                    const newNumber = input.value.trim();
                    if (newNumber === '') {
                        // Если пользователь очистил поле - удаляем номер
                        delete this.bedNumbers[bedNumberKey];
                        this.saveToStorage();
                        this.renderRooms();
                    } else if (newNumber) {
                        // Принимаем любой текст (числа, дроби типа "1/3", буквы)
                        this.bedNumbers[bedNumberKey] = newNumber;
                        this.saveToStorage();
                        this.renderRooms();
                    } else {
                        // Неверный ввод - просто перерисовываем
                        this.renderRooms();
                    }
                };
                
                input.addEventListener('blur', saveNumber);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        saveNumber();
                    }
                });
            },

            // Drag and Drop functions
            handleDragStart: function(e) {
                this.dragSrcEl = e.target;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.outerHTML);
                e.target.classList.add('dragging');
            },

            handleDragEnd: function(e) {
                e.target.classList.remove('dragging');
                document.querySelectorAll('.side-section').forEach(section => {
                    section.classList.remove('drag-over');
                });
            },

            handleDragOver: function(e) {
                e.preventDefault();
                return false;
            },

            handleDragEnter: function(e) {
                this.classList.add('drag-over');
            },

            handleDragLeave: function(e) {
                this.classList.remove('drag-over');
            },

            handleDrop: function(e) {
                e.stopPropagation();
                e.preventDefault();
                
                if (this.dragSrcEl !== this) {
                    const targetRoom = parseInt(this.dataset.room);
                    const targetSide = this.dataset.side;
                    const sourceRoom = parseInt(this.dragSrcEl.dataset.room);
                    const sourceSide = this.dragSrcEl.dataset.side;
                    const sourceIndex = parseInt(this.dragSrcEl.dataset.index);
                    const sourceType = this.dragSrcEl.dataset.type;
                    const sourceId = this.dragSrcEl.dataset.id;
                    
                    // Move bed in configuration
                    this.moveBed(sourceRoom, sourceSide, sourceIndex, targetRoom, targetSide, sourceId);
                }
                
                return false;
            },

            moveBed: function(fromRoom, fromSide, fromIndex, toRoom, toSide, bedId) {
                const sourceRoom = this.roomsConfig.find(room => room.number === fromRoom);
                const targetRoom = this.roomsConfig.find(room => room.number === toRoom);
                
                if (sourceRoom && targetRoom && sourceRoom.sides[fromSide].beds[fromIndex]) {
                    // Remove from source
                    const [movedBed] = sourceRoom.sides[fromSide].beds.splice(fromIndex, 1);
                    
                    // Add to target (в конец)
                    targetRoom.sides[toSide].beds.push(movedBed);
                    
                    this.saveToStorage();
                    this.renderRooms();
                    this.updateStats();
                }
            },

            deleteBed: function(roomNumber, side, bedIndex) {
                const room = this.roomsConfig.find(room => room.number === roomNumber);
                if (room && room.sides[side].beds[bedIndex]) {
                    const deletedBed = room.sides[side].beds[bedIndex];
                    
                    // Remove from configuration
                    room.sides[side].beds.splice(bedIndex, 1);
                    
                    // Remove associated residents
                    this.residents = this.residents.filter(resident => {
                        return !resident.bedId.includes(deletedBed.id);
                    });
                    
                    // Remove bed numbers for this bed
                    Object.keys(this.bedNumbers).forEach(key => {
                        if (key.startsWith(`${roomNumber}:${side}:${bedIndex}`)) {
                            delete this.bedNumbers[key];
                        }
                    });
                    
                    this.saveToStorage();
                    this.renderRooms();
                    this.renderResidents();
                    this.updateStats();
                    this.calculatePaymentStats();
                }
            },

            openAddBedModal: function(roomNumber, side) {
                this.currentAddingBedSide = { roomNumber, side };
                document.getElementById('addBedModal').style.display = 'block';
            },

            closeAddBedModal: function() {
                document.getElementById('addBedModal').style.display = 'none';
                this.currentAddingBedSide = null;
            },

            addNewBed: function() {
                if (!this.currentAddingBedSide) return;
                
                const bedType = document.getElementById('bedType').value;
                const room = this.roomsConfig.find(room => room.number === this.currentAddingBedSide.roomNumber);
                
                if (room) {
                    // Создаем уникальный ID для кровати
                    const bedId = `bed_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    
                    const roomNumber = this.currentAddingBedSide.roomNumber;
                    const side = this.currentAddingBedSide.side;
                    const bedIndex = room.sides[side].beds.length;
                    
                    // Добавляем кровать в конец массива
                    room.sides[side].beds.push({
                        type: bedType,
                        id: bedId
                    });
                    
                    // Создаем начальные номера для новой кровати
                    if (bedType === 'double') {
                        const topKey = `${roomNumber}:${side}:${bedIndex}:top`;
                        const bottomKey = `${roomNumber}:${side}:${bedIndex}:bottom`;
                        this.bedNumbers[topKey] = String((bedIndex * 2) + 1);
                        this.bedNumbers[bottomKey] = String((bedIndex * 2) + 2);
                    } else {
                        const singleKey = `${roomNumber}:${side}:${bedIndex}:single`;
                        this.bedNumbers[singleKey] = String(bedIndex + 1);
                    }
                    
                    this.saveToStorage();
                    this.renderRooms();
                    this.updateStats();
                    this.closeAddBedModal();
                }
            },

            // Residents management
            renderResidents: function() {
                const container = document.getElementById('residentsRows');
                container.innerHTML = '';

                this.residents.forEach((resident, index) => {
                    const row = document.createElement('div');
                    row.className = 'resident-row';
                    
                    const bedInfo = this.parseBedId(resident.bedId);
                    const bedNumberKey = `${bedInfo.roomNumber}:${bedInfo.side}:${bedInfo.bedIndex}:${bedInfo.level}`;
                    const bedNumber = this.bedNumbers[bedNumberKey] || '-';
                    
                    row.innerHTML = `
                        <div>${index + 1}</div>
                        <div>${resident.name}</div>
                        <div>${currentLanguage === 'ru' ? 'Комната' : currentLanguage === 'uz' ? 'Xona' : 'Room'} ${bedInfo.roomNumber}</div>
                        <div>${this.getSideTitle(bedInfo.side)}</div>
                        <div>${this.getBedLabel(bedInfo)}</div>
                        <div class="${bedNumber === '-' ? 'bed-number-empty' : 'bed-number-display'}">${bedNumber}</div>
                        <div><input type="date" class="resident-input" value="${resident.checkIn || ''}" onchange="roomsManager.updateResidentDate(${index}, 'checkIn', this.value)"></div>
                        <div><input type="date" class="resident-input" value="${resident.checkOut || ''}" onchange="roomsManager.updateResidentDate(${index}, 'checkOut', this.value)"></div>
                        <div>
                            <select class="custom-select" onchange="roomsManager.updateResidentSource(${index}, this.value)">
                                <option value="booking" ${resident.source === 'booking' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Booking' : currentLanguage === 'uz' ? 'Booking' : 'Booking'}</option>
                                <option value="clinic" ${resident.source === 'clinic' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Клиника' : currentLanguage === 'uz' ? 'Klinika' : 'Clinic'}</option>
                                <option value="street" ${resident.source === 'street' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Улица' : currentLanguage === 'uz' ? 'Ko\'cha' : 'Street'}</option>
                                <option value="other" ${resident.source === 'other' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Другое' : currentLanguage === 'uz' ? 'Boshqa' : 'Other'}</option>
                            </select>
                        </div>
                        <div>
                            <select class="custom-select" onchange="roomsManager.updateResidentPayment(${index}, this.value)">
                                <option value="cash" ${resident.payment === 'cash' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Наличные' : currentLanguage === 'uz' ? 'Naqd' : 'Cash'}</option>
                                <option value="terminal" ${resident.payment === 'terminal' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Терминал' : currentLanguage === 'uz' ? 'Terminal' : 'Terminal'}</option>
                                <option value="transfer" ${resident.payment === 'transfer' ? 'selected' : ''}>${currentLanguage === 'ru' ? 'Перевод' : currentLanguage === 'uz' ? 'O\'tkazma' : 'Transfer'}</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" class="resident-input" value="${this.formatAmountForDisplay(resident.amount)}" placeholder="0" onblur="roomsManager.updateResidentAmount(${index}, this)">
                        </div>
                    `;
                    
                    container.appendChild(row);
                });

                // Update payment statistics
                this.calculatePaymentStats();
            },

            parseBedId: function(bedId) {
                const parts = bedId.split(':');
                return {
                    roomNumber: parts[0],
                    side: parts[1],
                    bedIndex: parts[2],
                    level: parts[3],
                    bedType: parts[4]
                };
            },

            getBedLabel: function(bedInfo) {
                if (bedInfo.bedType === 'double') {
                    return `${bedInfo.level === 'top' ? (currentLanguage === 'ru' ? 'Верх' : currentLanguage === 'uz' ? 'Yuqori' : 'Top') : (currentLanguage === 'ru' ? 'Низ' : currentLanguage === 'uz' ? 'Pastki' : 'Bottom')} (${parseInt(bedInfo.bedIndex) + 1})`;
                } else {
                    return `${currentLanguage === 'ru' ? 'Одинарная' : currentLanguage === 'uz' ? 'Bir qavatli' : 'Single'} (${parseInt(bedInfo.bedIndex) + 1})`;
                }
            },

            updateResidentDate: function(index, field, value) {
                this.residents[index][field] = value;
                this.saveToStorage();
                this.calculatePaymentStats();
            },

            updateResidentSource: function(index, value) {
                this.residents[index].source = value;
                this.saveToStorage();
            },

            updateResidentPayment: function(index, value) {
                this.residents[index].payment = value;
                this.saveToStorage();
                this.calculatePaymentStats();
            },

            updateResidentAmount: function(index, input) {
                // Format the amount first
                this.formatAmountOnBlur(input);
                // Then parse and save
                this.residents[index].amount = this.parseFormattedAmount(input.value);
                this.saveToStorage();
                this.calculatePaymentStats();
            },

            // Modal functions
            openModal: function() {
                document.getElementById('addRoomModal').style.display = 'block';
            },

            closeModal: function() {
                document.getElementById('addRoomModal').style.display = 'none';
            },

            openResidentModal: function(bedId, roomNumber, side, bedIndex, level, bedType, existingResident) {
                this.currentEditingBed = bedId;
                
                const modal = document.getElementById('residentModal');
                const bedInfoEl = document.getElementById('residentBedInfo');
                
                const bedLabel = this.getBedLabel({ roomNumber, side, bedIndex, level, bedType });
                const sideTitle = this.getSideTitle(side);
                
                bedInfoEl.innerHTML = `
                    <strong>${currentLanguage === 'ru' ? 'Место:' : currentLanguage === 'uz' ? 'O\'rin:' : 'Place:'}</strong> ${currentLanguage === 'ru' ? 'Комната' : currentLanguage === 'uz' ? 'Xona' : 'Room'} ${roomNumber}, ${sideTitle}, ${bedLabel}
                `;
                
                if (existingResident) {
                    document.getElementById('residentName').value = existingResident.name;
                    document.getElementById('checkInDate').value = existingResident.checkIn || '';
                    document.getElementById('checkOutDate').value = existingResident.checkOut || '';
                    document.getElementById('residentSource').value = existingResident.source || 'booking';
                    document.getElementById('residentPayment').value = existingResident.payment || 'cash';
                    document.getElementById('residentAmount').value = this.formatAmountForDisplay(existingResident.amount);
                } else {
                    document.getElementById('residentName').value = '';
                    document.getElementById('checkInDate').value = '';
                    document.getElementById('checkOutDate').value = '';
                    document.getElementById('residentSource').value = 'booking';
                    document.getElementById('residentPayment').value = 'cash';
                    document.getElementById('residentAmount').value = '';
                }
                
                modal.style.display = 'block';
            },

            closeResidentModal: function() {
                document.getElementById('residentModal').style.display = 'none';
                this.currentEditingBed = null;
            },

            saveResident: function() {
                const name = document.getElementById('residentName').value.trim();
                const checkIn = document.getElementById('checkInDate').value;
                const checkOut = document.getElementById('checkOutDate').value;
                const source = document.getElementById('residentSource').value;
                const payment = document.getElementById('residentPayment').value;
                const amountInput = document.getElementById('residentAmount');
                
                // Format amount before saving
                this.formatAmountOnBlur(amountInput);
                const amount = this.parseFormattedAmount(amountInput.value);
                
                if (!name) {
                    alert(currentLanguage === 'ru' ? 'Пожалуйста, введите имя жильца' : 
                          currentLanguage === 'uz' ? 'Iltimos, yashovchi ismini kiriting' : 
                          'Please enter resident name');
                    return;
                }
                
                // Удаляем предыдущую запись для этой кровати
                this.residents = this.residents.filter(r => r.bedId !== this.currentEditingBed);
                
                // Добавляем нового жильца
                this.residents.push({
                    bedId: this.currentEditingBed,
                    name,
                    checkIn,
                    checkOut,
                    source,
                    payment,
                    amount
                });
                
                // Обновляем состояние кровати
                this.bedsState[this.currentEditingBed] = 1;
                
                this.saveToStorage();
                this.renderRooms();
                this.renderResidents();
                this.updateStats();
                this.closeResidentModal();
            },

            // Room management
            addNewRoom: function() {
                const number = parseInt(document.getElementById('roomNumber').value);
                const name = document.getElementById('roomName').value.trim();
                const leftDouble = parseInt(document.getElementById('leftDoubleBeds').value) || 0;
                const leftSingle = parseInt(document.getElementById('leftSingleBeds').value) || 0;
                const rightDouble = parseInt(document.getElementById('rightDoubleBeds').value) || 0;
                const rightSingle = parseInt(document.getElementById('rightSingleBeds').value) || 0;
                const centerDouble = parseInt(document.getElementById('centerDoubleBeds').value) || 0;
                const centerSingle = parseInt(document.getElementById('centerSingleBeds').value) || 0;
                
                if (!number || !name) {
                    alert(currentLanguage === 'ru' ? 'Пожалуйста, заполните номер и название комнаты' : 
                          currentLanguage === 'uz' ? 'Iltimos, xona raqami va nomini kiriting' : 
                          'Please fill in room number and name');
                    return;
                }
                
                // Проверяем, существует ли уже комната с таким номером
                if (this.roomsConfig.some(room => room.number === number)) {
                    alert(currentLanguage === 'ru' ? 'Комната с таким номером уже существует' : 
                          currentLanguage === 'uz' ? 'Bu raqamli xona mavjud' : 
                          'Room with this number already exists');
                    return;
                }
                
                const newRoom = {
                    number,
                    name,
                    sides: {
                        left: { beds: [] },
                        right: { beds: [] },
                        center: { beds: [] }
                    }
                };
                
                // Добавляем кровати в том порядке, в котором они указаны
                for (let i = 0; i < leftDouble; i++) {
                    newRoom.sides.left.beds.push({ type: 'double', id: `double_${Date.now()}_${i}` });
                }
                for (let i = 0; i < leftSingle; i++) {
                    newRoom.sides.left.beds.push({ type: 'single', id: `single_${Date.now()}_${i + leftDouble}` });
                }
                for (let i = 0; i < rightDouble; i++) {
                    newRoom.sides.right.beds.push({ type: 'double', id: `double_${Date.now()}_${i + leftDouble + leftSingle}` });
                }
                for (let i = 0; i < rightSingle; i++) {
                    newRoom.sides.right.beds.push({ type: 'single', id: `single_${Date.now()}_${i + leftDouble + leftSingle + rightDouble}` });
                }
                for (let i = 0; i < centerDouble; i++) {
                    newRoom.sides.center.beds.push({ type: 'double', id: `double_${Date.now()}_${i + leftDouble + leftSingle + rightDouble + rightSingle}` });
                }
                for (let i = 0; i < centerSingle; i++) {
                    newRoom.sides.center.beds.push({ type: 'single', id: `single_${Date.now()}_${i + leftDouble + leftSingle + rightDouble + rightSingle + centerDouble}` });
                }
                
                this.roomsConfig.push(newRoom);
                this.saveToStorage();
                this.renderRooms();
                this.updateStats();
                this.closeModal();
                
                // Очищаем форму
                document.getElementById('roomNumber').value = '';
                document.getElementById('roomName').value = '';
                document.getElementById('leftDoubleBeds').value = '';
                document.getElementById('leftSingleBeds').value = '';
                document.getElementById('rightDoubleBeds').value = '';
                document.getElementById('rightSingleBeds').value = '';
                document.getElementById('centerDoubleBeds').value = '';
                document.getElementById('centerSingleBeds').value = '';
            },

            updateRoomName: function(roomNumber, newName) {
                const room = this.roomsConfig.find(r => r.number === roomNumber);
                if (room && newName.trim()) {
                    room.name = newName.trim();
                    this.saveToStorage();
                }
            },

            deleteRoom: function(roomNumber) {
                if (!confirm(currentLanguage === 'ru' ? 'Вы уверены, что хотите удалить эту комнату?' : 
                             currentLanguage === 'uz' ? 'Bu xonani o\'chirishni istaysizmi?' : 
                             'Are you sure you want to delete this room?')) {
                    return;
                }
                
                // Удаляем комнату из конфигурации
                this.roomsConfig = this.roomsConfig.filter(room => room.number !== roomNumber);
                
                // Удаляем связанные состояния кроватей
                Object.keys(this.bedsState).forEach(key => {
                    if (key.startsWith(`${roomNumber}:`)) {
                        delete this.bedsState[key];
                    }
                });
                
                // Удаляем связанных жильцов
                this.residents = this.residents.filter(resident => {
                    const bedInfo = this.parseBedId(resident.bedId);
                    return bedInfo.roomNumber !== roomNumber.toString();
                });
                
                this.saveToStorage();
                this.renderRooms();
                this.renderResidents();
                this.updateStats();
            },

            resetAllBeds: function() {
                if (!confirm(currentLanguage === 'ru' ? 'Вы уверены, что хотите сбросить все кровати? Все данные о жильцах будут удалены.' : 
                             currentLanguage === 'uz' ? 'Barcha karavotlarni qayta o\'rnatishni istaysizmi? Barcha yashovchi ma\'lumotlari o\'chiriladi.' : 
                             'Are you sure you want to reset all beds? All resident data will be deleted.')) {
                    return;
                }
                
                this.bedsState = {};
                this.residents = [];
                this.bedNumbers = {};
                this.saveToStorage();
                this.renderRooms();
                this.renderResidents();
                this.updateStats();
            },

            // Print function for residents list
            printResidentsList: function() {
                window.print();
            },

            // Stats
            updateStats: function() {
                let totalBeds = 0;
                let occupiedBeds = 0;
                
                this.roomsConfig.forEach(room => {
                    Object.values(room.sides).forEach(side => {
                        side.beds.forEach(bed => {
                            totalBeds += bed.type === 'double' ? 2 : 1;
                        });
                    });
                });
                
                occupiedBeds = Object.values(this.bedsState).filter(state => state === 1).length;
                
                const statsEl = document.getElementById('stats');
                statsEl.textContent = `${currentLanguage === 'ru' ? 'Всего мест' : currentLanguage === 'uz' ? 'Jami joylar' : 'Total beds'}: ${totalBeds} · ${currentLanguage === 'ru' ? 'Свободно' : currentLanguage === 'uz' ? 'Bo\'sh' : 'Free'}: ${totalBeds - occupiedBeds} · ${currentLanguage === 'ru' ? 'Занято' : currentLanguage === 'uz' ? 'Band' : 'Occupied'}: ${occupiedBeds}`;
            }
        };

        // Initialize authentication check (after roomsManager is defined)
        checkAuthentication();

        // Copy to clipboard functionality
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const textToCopy = this.getAttribute('data-text');
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const originalText = this.textContent;
                        this.textContent = currentLanguage === 'ru' ? 'Скопировано!' : currentLanguage === 'uz' ? 'Nusxalandi!' : 'Copied!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 2000);
                    });
                });
            });
        });

        // Update resident header for mobile view
        function updateResidentHeaderForMobile() {
            if (window.innerWidth <= 768) {
                const labels = [
                    'resident_number', 'resident_name', 'resident_room', 'resident_side', 
                    'resident_bed', 'resident_bed_number', 'resident_checkin', 'resident_checkout', 
                    'resident_source', 'resident_payment', 'resident_amount'
                ];
                
                document.querySelectorAll('.resident-header > div, .resident-row > div').forEach((div, index) => {
                    if (index < labels.length) {
                        div.setAttribute('data-label', translations[currentLanguage][labels[index]] || labels[index]);
                    }
                });
            }
        }

        // Update on language change and window resize
        window.addEventListener('resize', updateResidentHeaderForMobile);
    </script>
    
    <!-- API Integration - должен быть загружен ПОСЛЕ всех других скриптов -->
    <script src="api-integration.js"></script>
    <script src="date-picker-modal.js"></script>
    <script src="admin-api-integration.js"></script>

</body>
</html>